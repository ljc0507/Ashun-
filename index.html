<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ashun+ ç¤¾ç¾¤è²¼æ–‡å°å¹«æ‰‹ (AIç‰ˆ)</title>
    
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- è¼‰å…¥ React å’Œ Babel (ç”¨æ–¼è§£æ JSX) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- å®šç¾©æ¨£å¼èˆ‡å­—å‹ -->
    <style>
        /* é‡å° 20-40 æ­²ä½¿ç”¨ç¿’æ…£ï¼Œå„ªåŒ–å­—é«”é¡¯ç¤ºèˆ‡è§¸æ§é«”é©— */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans TC", "Microsoft JhengHei", sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* è‡ªè¨‚æ²è»¸æ¨£å¼ */
        @media (pointer: fine) {
            .custom-scrollbar::-webkit-scrollbar {
                width: 6px;
                height: 6px;
            }
            .custom-scrollbar::-webkit-scrollbar-track {
                background: transparent; 
            }
            .custom-scrollbar::-webkit-scrollbar-thumb {
                background: #cbd5e1; 
                border-radius: 3px;
            }
            .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                background: #94a3b8; 
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pop-in {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes popIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        /* éš±è—æ²è»¸ä½†ä¿ç•™åŠŸèƒ½ */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* Loading å‹•ç•« */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin 3s linear infinite;
        }
        
        input, select, textarea {
            font-size: 16px !important; 
        }

        @media (max-width: 640px) {
            .modal-content-mobile {
                animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
                border-bottom-left-radius: 0;
                border-bottom-right-radius: 0;
            }
            @keyframes slideUp {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
            }
        }
        
        .safe-area-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 h-[100dvh] overflow-hidden flex flex-col">
    <div id="root" class="h-full flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- åœ–ç¤ºçµ„ä»¶ ---
        const IconWrapper = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Calendar = (props) => <IconWrapper {...props}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></IconWrapper>;
        const Clock = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></IconWrapper>;
        const Instagram = (props) => <IconWrapper {...props}><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></IconWrapper>;
        const Facebook = (props) => <IconWrapper {...props}><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></IconWrapper>;
        const AtSign = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="4"></circle><path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-3.92 7.94"></path></IconWrapper>;
        const Plus = (props) => <IconWrapper {...props}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></IconWrapper>;
        const Trash2 = (props) => <IconWrapper {...props}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></IconWrapper>;
        const Edit2 = (props) => <IconWrapper {...props}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></IconWrapper>;
        const Copy = (props) => <IconWrapper {...props}><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></IconWrapper>;
        const Save = (props) => <IconWrapper {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></IconWrapper>;
        const X = (props) => <IconWrapper {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></IconWrapper>;
        const LayoutGrid = (props) => <IconWrapper {...props}><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></IconWrapper>;
        const ListIcon = (props) => <IconWrapper {...props}><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></IconWrapper>;
        const ImageIcon = (props) => <IconWrapper {...props}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></IconWrapper>;
        const Upload = (props) => <IconWrapper {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></IconWrapper>;
        const XCircle = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></IconWrapper>;
        const Lightbulb = (props) => <IconWrapper {...props}><line x1="9" y1="18" x2="15" y2="18"></line><line x1="10" y1="22" x2="14" y2="22"></line><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 16.5 8c0-2.3-1.5-4.5-4.5-4.5S7.5 5.7 7.5 8c0 1.47.5 2.5 1.5 3.5.76.76 1.23 1.52 1.4 2.5"></path></IconWrapper>;
        const ArrowRight = (props) => <IconWrapper {...props}><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></IconWrapper>;
        const Package = (props) => <IconWrapper {...props}><path d="M16.5 9.4 7.55 4.24" /><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" /><polyline points="3.29 7 12 12 20.71 7" /><line x1="12" y1="22" x2="12" y2="12" /></IconWrapper>;
        const Check = (props) => <IconWrapper {...props}><polyline points="20 6 9 17 4 12"></polyline></IconWrapper>;
        const FileText = (props) => <IconWrapper {...props}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></IconWrapper>;
        const Heart = (props) => <IconWrapper {...props}><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></IconWrapper>;
        const MessageCircle = (props) => <IconWrapper {...props}><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></IconWrapper>;
        const ThumbsUp = (props) => <IconWrapper {...props}><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></IconWrapper>;
        const Flame = (props) => <IconWrapper {...props}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.5-3.3.7 1.37 1.5 2.5 3 2.8z"></path></IconWrapper>;
        const BarChart2 = (props) => <IconWrapper {...props}><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></IconWrapper>;
        const Download = (props) => <IconWrapper {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></IconWrapper>;
        const Sparkles = (props) => <IconWrapper {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path></IconWrapper>;
        const Book = (props) => <IconWrapper {...props}><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></IconWrapper>;
        const Tag = (props) => <IconWrapper {...props}><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></IconWrapper>;
        const Zap = (props) => <IconWrapper {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></IconWrapper>;
        const ShoppingBag = (props) => <IconWrapper {...props}><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></IconWrapper>;
        const Gift = (props) => <IconWrapper {...props}><polyline points="20 12 20 22 4 22 4 12"></polyline><rect x="2" y="7" width="20" height="5"></rect><line x1="12" y1="22" x2="12" y2="7"></line><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path></IconWrapper>;
        const Megaphone = (props) => <IconWrapper {...props}><path d="m3 11 18-5v12L3 14v-3z"></path><path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"></path></IconWrapper>;
        const ArrowLeft = (props) => <IconWrapper {...props}><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></IconWrapper>;
        const Settings = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></IconWrapper>;
        const Archive = (props) => <IconWrapper {...props}><polyline points="21 8 21 21 3 21 3 8"></polyline><rect x="1" y="3" width="22" height="5"></rect><line x1="10" y1="12" x2="14" y2="12"></line></IconWrapper>;
        const Dice = (props) => <IconWrapper {...props}><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><circle cx="16" cy="8" r="2"></circle><circle cx="8" cy="16" r="2"></circle><circle cx="8" cy="8" r="2"></circle><circle cx="16" cy="16" r="2"></circle><circle cx="12" cy="12" r="2"></circle></IconWrapper>;

        // é è¨­ Hashtag
        const HASHTAG_PRESETS = {
            'é€šç”¨': ['#å°ç·¨æ—¥å¸¸', '#ç”Ÿæ´»åˆ†äº«', '#daily', '#ootd', '#å¿ƒæƒ…'],
            'ä¿ƒéŠ·': ['#æ–°å“ä¸Šå¸‚', '#é™æ™‚å„ªæƒ ', '#sale', '#å¥½åº·åˆ†äº«', '#æŠ½ç'],
            'ç¯€æ—¥': ['#æƒ…äººç¯€', '#è–èª•ç¯€', '#é€±å¹´æ…¶', '#è·¨å¹´', '#æ”¾å‡'],
            'å“ç‰Œ': ['#å“ç‰Œåç¨±', '#è¨­è¨ˆ', '#è³ªæ„Ÿ', '#æ¨è–¦', '#å¿…è²·']
        };

        // æ›´æ–°åˆ†é¡èˆ‡æ¨™ç±¤çµæ§‹
        const CATEGORY_LABELS = {
            // åŸæœ‰å•†æ¥­é¡ (åˆä½µæ–°å“èˆ‡ä¿ƒéŠ·)
            'new_arrival': { label: 'âœ¨ æ–°å“/ä¿ƒéŠ·', icon: 'ğŸ›ï¸', color: 'bg-gradient-to-r from-purple-100 to-pink-100 text-purple-700' },
            'greeting':    { label: 'â¤ï¸ ç¯€æ…¶ç¥ç¦', icon: 'ğŸ', color: 'bg-red-50 text-red-700 border-red-100' },
            'announcement':{ label: 'ğŸ“¢ é‡è¦ä½ˆå‘Š', icon: 'ğŸ“', color: 'bg-slate-100 text-slate-700 border-slate-200' },
            'feature':     { label: 'ğŸ” è³ªæ„Ÿ/æ•™å­¸', icon: 'âœ¨', color: 'bg-blue-50 text-blue-700 border-blue-100' },
            'interaction': { label: 'ğŸ’¬ äº’å‹•/å¾µåœ–', icon: 'ğŸ“¸', color: 'bg-orange-50 text-orange-700 border-orange-100' },
            
            // --- Threads å°ˆç”¨ 6 å¤§åˆ†é¡ (v3.0 æ ¸å¿ƒ) ---
            'th_chat':     { label: 'â˜• æ—¥å¸¸èŠå¤©', icon: 'ğŸ’¬', color: 'bg-stone-100 text-stone-600 border-stone-200' },
            'th_growth':   { label: 'ğŸ“ˆ å¢ç²‰äº’å‹•', icon: 'ğŸ¤', color: 'bg-blue-50 text-blue-600 border-blue-200' },
            'th_brand':    { label: 'ğŸ§¡ å“ç‰Œé™ªä¼´', icon: 'ğŸ§¸', color: 'bg-orange-50 text-orange-600 border-orange-200' },
            'th_obs':      { label: 'ğŸ§ è§€å¯Ÿ/æŠ€å·§', icon: 'ğŸ’¡', color: 'bg-cyan-50 text-cyan-600 border-cyan-200' },
            'th_prod':     { label: 'ğŸ’ ä½èª¿å¸¶è²¨', icon: 'ğŸ›’', color: 'bg-purple-50 text-purple-600 border-purple-200' },
            'th_emo':      { label: 'ğŸ«‚ æƒ…ç·’å…±é³´', icon: 'â¤ï¸', color: 'bg-rose-50 text-rose-600 border-rose-200' },
        };

        // v3.0 æ–°å¢ï¼šThreads ç‹€æ…‹æ¨™ç±¤ç¾¤çµ„
        const THREADS_TAG_GROUPS = {
            'ğŸ§  ç‹€æ…‹': ['#æ²’éˆæ„Ÿ', '#å¾ˆå¿™', '#ä½èƒ½é‡', '#æƒ³èŠå¤©', '#æƒ³è¡ç²‰', '#ä»Šå¤©å¾ˆç´¯', '#éš¨ä¾¿ç™¼'],
            'â± æ™‚é–“': ['#30ç§’å¯ç™¼', '#1åˆ†é˜å®Œæˆ', '#ä¸ç”¨æƒ³', '#ç›´æ¥è²¼'],
            'ğŸ“ˆ æ•ˆæœ': ['#é«˜å›è¦†', '#å®¹æ˜“è¢«å›', '#å¼•æˆ°å®‰å…¨', '#é©åˆæ–°å¸³', '#è€ç²‰å…±é³´'],
            'ğŸ’¬ é¢¨æ ¼': ['#å°ç·¨å£èª', '#æœ‹å‹èŠå¤©', '#è¼•é¬†', '#çœŸå¿ƒè©±', '#ç¢å¿µç³»']
        };

        // AI Tones Definition
        const AI_TONES = [
            { id: 'professional', label: 'ğŸ› ï¸ å°ˆæ¥­è·äºº', desc: 'å»ºç«‹ä¿¡ä»»ã€å¼·èª¿å·¥è—ã€å¯¦æ¸¬', platforms: 'Facebook (é©åˆé•·æ–‡)' },
            { id: 'aesthetic', label: 'ğŸŒ¿ è³ªæ„Ÿæ–‡é’', desc: 'ç”Ÿæ´»ç¾å­¸ã€æ—¥å¸¸é»ç¶´', platforms: 'Instagram (è²¼æ–‡/Reels)' },
            { id: 'relatable', label: 'ğŸ«  äººé–“çœŸå¯¦', desc: 'å¼•ç™¼å…±é³´ã€å¾®å­ä¸–ã€çœŸå¿ƒè©±', platforms: 'Threads (çŸ­å¥)' },
            { id: 'bestie', label: 'ğŸ‘¯â€â™€ï¸ é–¨èœœå‹¸æ•—', desc: 'çœŸå¿ƒæ¨è–¦ã€æ‹‰è¿‘è·é›¢', platforms: 'Instagram (é™å‹•)' },
            { id: 'story', label: 'ğŸ“– æ„Ÿæ€§æ•…äº‹', desc: 'è³¦äºˆæƒ…æ„Ÿã€å“ç‰Œæ•…äº‹', platforms: 'Facebook' },
            { id: 'enthusiastic', label: 'ğŸ”¥ ç†±æƒ…ä¿ƒéŠ·', desc: 'é©åˆæ–°å“ä¸Šå¸‚ã€é™æ™‚å„ªæƒ ', platforms: 'Instagram (è²¼æ–‡/Reels)' },
            { id: 'warm', label: 'â¤ï¸ æº«æš–æ„Ÿæ€§', desc: 'é©åˆç¯€æ—¥ç¥è³€ã€æ„Ÿè¬æ–‡', platforms: 'Facebook, Instagram' },
            { id: 'humorous', label: 'ğŸ¤£ å¹½é»˜æœ‰è¶£', desc: 'é©åˆäº’å‹•ã€è¼•é¬†è©±é¡Œ', platforms: 'Instagram (é™å‹•)' },
        ];

        // æ“´å……å¾Œçš„æ¨¡æ¿åº« (æ•´åˆæ‰€æœ‰æ¨¡ç‰ˆ + Threads 6å¤§é¡)
        const TEMPLATE_LIBRARY = [
            // --- 1ï¸âƒ£ Threadsï½œå°ç·¨æ—¥å¸¸èŠå¤© ---
            { id: "th_chat_01", mainCategory: "th_chat", subCategory: "æ—©å®‰", title: "èŠå¤©ï½œæ—©å®‰ç²¾ç¥å–Šè©±", platforms: ["threads"], mood: "â˜€ï¸ æ­£å‘", usageTip: "â±ï¸ 30ç§’å¯ç™¼", tags: ["#æ—©å®‰", "#æ²’éˆæ„Ÿ", "#30ç§’å¯ç™¼", "#è¼•é¬†"], content: "æ—©å®‰ï¼â˜€ï¸\nå°ç·¨å·²ç¶“åœ¨ä½ç½®ä¸Šäº†ã€‚\n\né›–ç„¶éˆé­‚é‚„åœ¨åºŠä¸Šï¼Œ\nä½†æ‰‹æŒ‡å·²ç¶“æº–å‚™å¥½å›è¨Šæ¯äº†ã€‚\n\nå¤§å®¶ä»Šå¤©ä¹Ÿè¦åŠ æ²¹å–”ï¼ğŸ’ª" },
            { id: "th_chat_02", mainCategory: "th_chat", subCategory: "é–’èŠ", title: "èŠå¤©ï½œä»Šæ—¥å°äº‹åˆ†äº«", platforms: ["threads"], mood: "â˜• è¼•é¬†", usageTip: "ğŸ’¡ æ²’äº‹ä¹Ÿèƒ½ç™¼", tags: ["#éš¨ä¾¿ç™¼", "#å°ç·¨å£èª", "#æœ‹å‹èŠå¤©"], content: "å‰›å‰›ç™¼ç”Ÿäº†ä¸€ä»¶å¾ˆè ¢çš„äº‹...\n(åœ¨æ­¤è¼¸å…¥ä½ çš„è ¢äº‹ï¼Œä¾‹å¦‚ï¼šæŠŠæ´—é¢ä¹³ç•¶ç‰™è†åˆ·)\n\næœ‰äººä¹Ÿè·Ÿæˆ‘ä¸€æ¨£é‡‘é­šè…¦å—ï¼ŸğŸ˜‚\nå‘Šè¨´æˆ‘æˆ‘ä¸å­¤å–®ï¼" },
            { id: "th_chat_03", mainCategory: "th_chat", subCategory: "æ™šå®‰", title: "èŠå¤©ï½œä¸‹ç­å„€å¼æ„Ÿ", platforms: ["threads"], mood: "ğŸŒ™ ç™‚ç™’", usageTip: "ğŸ’¤ ä½èƒ½é‡æ—¥ç”¨", tags: ["#ä»Šå¤©å¾ˆç´¯", "#ä½èƒ½é‡", "#æ™šå®‰"], content: "çµ‚æ–¼ä¸‹ç­äº†ï¼(ç™±)\nä»Šå¤©å¤§å®¶çš„é›»åŠ›å‰©å¹¾è¶´ï¼ŸğŸ”‹\n\næˆ‘å¤§æ¦‚å‰© 1%ï¼Œ\néœ€è¦ä¸€æ¯çå¥¶å……é›» ğŸ§‹\næ™šå®‰å„ä½ï¼Œæ˜å¤©è¦‹ï¼ğŸ‘‹" },

            // --- 2ï¸âƒ£ Threadsï½œå¢ç²‰äº’å‹• ---
            { id: "th_growth_01", mainCategory: "th_growth", subCategory: "äºŒé¸ä¸€", title: "äº’å‹•ï½œçµ‚æ¥µäºŒé¸ä¸€", platforms: ["threads"], mood: "ğŸ¤” ç³¾çµ", usageTip: "ğŸ“ˆ å®¹æ˜“è¢«å›", tags: ["#é«˜å›è¦†", "#æƒ³è¡ç²‰", "#å¼•æˆ°å®‰å…¨"], content: "ğŸ”´ é‚„æ˜¯ ğŸ”µï¼Ÿ\n\nå¦‚æœæ˜¯ä½ ï¼Œæ—©é¤ä¸€å®šè¦åƒï¼š\nğŸ…°ï¸ è›‹é¤… (å°å¼æ´¾)\nğŸ…±ï¸ æ¼¢å ¡ (è¥¿å¼æ´¾)\n\næˆ‘æ˜¯çµ•å°çš„ A æ´¾ï¼ä½ å€‘å‘¢ï¼Ÿ\nåº•ä¸‹ç•™è¨€ PK ä¸€ä¸‹ï¼âš”ï¸" },
            { id: "th_growth_02", mainCategory: "th_growth", subCategory: "æå•", title: "äº’å‹•ï½œéˆé­‚æ‹·å•", platforms: ["threads"], mood: "â“ å¥½å¥‡", usageTip: "ğŸ’¬ é©åˆæ–°å¸³", tags: ["#å®¹æ˜“è¢«å›", "#æƒ³èŠå¤©", "#å•ç­”å‹"], content: "å•ä¸€å€‹å¾ˆåš´è‚…çš„å•é¡Œï¼š\n\nä½ åƒå’–å“©é£¯æœƒã€Œæ‹Œã€é‚„æ˜¯ã€Œä¸æ‹Œã€ï¼ŸğŸ›\n\n1. æ‹Œï¼æ¯ä¸€å£éƒ½è¦æœ‰é†¬\n2. ä¸æ‹Œï¼åˆ†é–‹åƒæ‰æ˜¯ç‹é“\n\n(å°ç·¨è¦ºå¾—ä¸æ‹Œçš„äººéƒ½æ˜¯ç•°æ•™å¾’...é€ƒ ğŸƒâ€â™‚ï¸)" },
            { id: "th_growth_03", mainCategory: "th_growth", subCategory: "æ¥é¾", title: "äº’å‹•ï½œä¸€å¥è©±æ¥é¾", platforms: ["threads"], mood: "ğŸ¤ª æœ‰è¶£", usageTip: "ğŸ§  ä¸ç”¨æƒ³", tags: ["#å¯æ¥é¾", "#è¼•é¬†", "#é«˜å›è¦†"], content: "ä¾†ç©æ¥é¾ï¼ğŸ‰\n\næˆ‘å…ˆï¼š\nã€Œä»Šå¤©å¤©æ°£çœŸå¥½ï¼Œé©åˆ...ã€\n\næ›ä½ æ¥ï¼ğŸ‘‡" },

            // --- 3ï¸âƒ£ Threadsï½œå“ç‰Œé™ªä¼´æ„Ÿ ---
            { id: "th_brand_01", mainCategory: "th_brand", subCategory: "å¹•å¾Œ", title: "å“ç‰Œï½œå‡ºè²¨æ—¥å¸¸", platforms: ["threads"], mood: "ğŸ“¦ å……å¯¦", usageTip: "ğŸ§¡ å»ºç«‹ä¿¡ä»»", tags: ["#å°ç·¨å¹•å¾Œ", "#å¾ˆå¿™", "#è€ç²‰å…±é³´"], content: "é›–ç„¶åŒ…è²¨åŒ…åˆ°æ‰‹å¿«æ–·äº†ï¼Œ\nä½†çœ‹åˆ°å¤§å®¶çš„è¨‚å–®å‚™è¨»å¯«è‘—ã€Œè¾›è‹¦äº†ã€ï¼Œ\nç¬é–“è¡€æ¢å…¨æ»¿ï¼ğŸ’ª\n\nä½ å€‘éƒ½æ˜¯å¤©ä½¿å—ï¼ŸğŸ‘¼\næ¯ä¸€åŒ…æˆ‘å€‘éƒ½å¡äº†æ»¿æ»¿çš„æ„›å–”ï¼(é‚„æœ‰è´ˆå“ğŸ˜†)" },
            { id: "th_brand_02", mainCategory: "th_brand", subCategory: "å‰µæ¥­", title: "å“ç‰Œï½œå‰µæ¥­å¾®ç¢å¿µ", platforms: ["threads"], mood: "ğŸŒ± æ„Ÿæ€§", usageTip: "ğŸ“ ç¶“ç‡Ÿå¿ƒæ³•", tags: ["#çœŸå¿ƒè©±", "#å‰µæ¥­æ—¥è¨˜", "#æ·±åº¦"], content: "å‰µæ¥­å°±æ˜¯ï¼š\nç™½å¤©ç•¶è€é—†ï¼Œæ™šä¸Šç¡åœ°æ¿ã€‚\nè‡ªå·±é¸çš„è·¯ï¼Œè·ªè‘—ä¹Ÿè¦èµ°å®Œã€‚ğŸ˜­\n\né›–ç„¶ç´¯ï¼Œä½†çœ‹åˆ°ä½ å€‘æ”¶åˆ°å•†å“çš„ç¬‘å®¹ï¼Œ\nå°±è¦ºå¾—ä¸€åˆ‡éƒ½å€¼äº†ã€‚\nå„ä½è€é—†å€‘åŠ æ²¹ï¼" },

            // --- 4ï¸âƒ£ Threadsï½œæµé‡è§€å¯Ÿ / å°æŠ€å·§ ---
            { id: "th_obs_01", mainCategory: "th_obs", subCategory: "è§€å¯Ÿ", title: "è§€å¯Ÿï½œæ¼”ç®—æ³•è®Šäº†ï¼Ÿ", platforms: ["threads"], mood: "ğŸ§ ç–‘æƒ‘", usageTip: "ğŸ“‰ æµé‡ä½è¿·æ™‚ç™¼", tags: ["#ç¤¾ç¾¤è§€å¯Ÿ", "#æµé‡å¿ƒå¾—", "#å°ç·¨å£èª"], content: "Threads ä»Šå¤©æ€ªæ€ªçš„...\n\næˆ‘çš„è§¸åŠæ˜¯ä¸æ˜¯è¢«åƒæ‰äº†ï¼ŸğŸ¦–\næœ‰æ²’æœ‰äººä¹Ÿè¦ºå¾—ä»Šå¤©éœæ‚„æ‚„ï¼Ÿ\n\né‚„æ˜¯å–®ç´”æˆ‘ç™¼æ–‡å¤ªç„¡èŠ (èª¤)\nå‡ºä¾†å–Šå€‹è²è®“æˆ‘çŸ¥é“ä½ ä¸å­¤å–®ï¼ğŸ™‹" },
            { id: "th_obs_02", mainCategory: "th_obs", subCategory: "æŠ€å·§", title: "æŠ€å·§ï½œæ‹ç…§å°æ’‡æ­¥", platforms: ["threads"], mood: "ğŸ’¡ å°ˆæ¥­", usageTip: "ğŸ§  ä¹¾è²¨åˆ†äº«", tags: ["#å°æŠ€å·§", "#ç¶“é©—è«‡", "#æ”¶è—"], content: "ã€å°ç·¨ä¸è—ç§åˆ†äº«ã€‘ğŸ“¸\n\nå•†å“ç…§æ€éº¼æ‹æ‰å¥½çœ‹ï¼Ÿ\nå…¶å¯¦åªè¦é€™ 3 æ‹›ï¼š\n1. è‡ªç„¶å…‰æ˜¯ç¥ (çª—é‚Šç„¡æ•µ)\n2. èƒŒæ™¯ä¹¾æ·¨ (ä¸€å¼µç™½ç´™å°±å¥½)\n3. ç¨å¾®å‚¾æ–œ 45 åº¦ (é¡¯ç˜¦?!)\n\nè©¦è©¦çœ‹ï¼Œè³ªæ„Ÿé¦¬ä¸Šæå‡å–”ï¼âœ¨" },

            // --- 5ï¸âƒ£ Threadsï½œä½èª¿å¸¶ç”¢å“ ---
            { id: "th_prod_01", mainCategory: "th_prod", subCategory: "æƒ…å¢ƒ", title: "å¸¶è²¨ï½œç”Ÿæ´»æƒ…å¢ƒæ¤å…¥", platforms: ["threads"], mood: "ğŸ’ è‡ªç„¶", usageTip: "ğŸ›ï¸ ä¸åƒå»£å‘Š", tags: ["#æ—¥å¸¸é †å¸¶æ", "#ä½¿ç”¨æƒ…å¢ƒ", "#è»Ÿæ€§æ¨å»£"], content: "ä»Šå¤©å¸¶å­©å­å»å…¬åœ’æ”¾é›»ï¼Œ\né‚„å¥½æœ‰å¸¶ {ç”¢å“å}ï¼Œ\nä¸ç„¶æˆ‘çœŸçš„æœƒå´©æ½°... ğŸ˜±\n\nçœŸå¿ƒå»ºè­°å„ä½çˆ¸åª½è»Šä¸Šéƒ½è¦å‚™ä¸€å€‹ï¼Œ\næ•‘å‘½ç¥å™¨ç„¡èª¤ï¼\n(é€£çµåœ¨é¦–é å–”ï¼Œéœ€è¦çš„è‡ªå·±çœ‹)" },
            { id: "th_prod_02", mainCategory: "th_prod", subCategory: "æé†’", title: "å¸¶è²¨ï½œåº«å­˜å‘Šæ€¥æé†’", platforms: ["threads"], mood: "ğŸš¨ ç·Šæ€¥", usageTip: "â±ï¸ 1åˆ†é˜å®Œæˆ", tags: ["#å°æé†’", "#ç›´æ¥è²¼", "#30ç§’å¯ç™¼"], content: "é‚£å€‹...\né›–ç„¶ä¸æƒ³çµ¦å£“åŠ›ï¼Œ\nä½† {ç†±é–€è‰²} çœŸçš„å‰©æœ€å¾Œ 5 å€‹äº†ã€‚\n\nçœŸçš„æ²’äº†å°±æ²’äº†ï¼Œ\nä¸è¦å†ç§è¨Šå•å°ç·¨èƒ½ä¸èƒ½ç”Ÿå‡ºä¾†å›‰ ğŸ™\næ‰‹åˆ€å»å®˜ç¶²ï¼ğŸƒğŸ’¨" },

            // --- 6ï¸âƒ£ Threadsï½œæƒ…ç·’å…±é³´ ---
            { id: "th_emo_01", mainCategory: "th_emo", subCategory: "å¿ƒè²", title: "å…±é³´ï½œä¸æƒ³ä¸Šç­", platforms: ["threads"], mood: "ğŸ«  å­ä¸–", usageTip: "ğŸ’¤ é€±ä¸€å¿…ç™¼", tags: ["#ä¸Šç­æ—å¿ƒè²", "#å£“åŠ›", "#å…±é³´"], content: "æˆ‘çš„éˆé­‚é‚„ç•™åœ¨åºŠä¸Šï¼Œ\nåªæœ‰è‚‰é«”ä¾†å…¬å¸äº†ã€‚ğŸ‘»\n\næœ‰äººè·Ÿæˆ‘ä¸€æ¨£é‚„æ²’é–‹æ©Ÿå—ï¼Ÿ\n(èˆ‰æ‰‹)" },
            { id: "th_emo_02", mainCategory: "th_emo", subCategory: "å°ç¢ºå¹¸", title: "å…±é³´ï½œå¥¶èŒ¶å“²å­¸", platforms: ["threads"], mood: "ğŸ§‹ å¿«æ¨‚", usageTip: "â˜• ä¸‹åˆèŒ¶æ™‚é–“", tags: ["#è‡ªæˆ‘é¼“å‹µ", "#è¼•é¬†", "#å°ç·¨å£èª"], content: "éŒ¢è²·ä¸åˆ°å¿«æ¨‚ï¼Œ\nä½†éŒ¢å¯ä»¥è²·çç å¥¶èŒ¶ï¼Œ\né‚£åŸºæœ¬ä¸Šæ˜¯ä¸€æ¨£çš„æ„æ€ã€‚ğŸ§‹\n\nä»Šå¤©çš„å°ç¢ºå¹¸ï¼Œ\nä½ å€‘å–ä»€éº¼ï¼Ÿ" },

            // --- åŸæœ‰å…¶ä»–æ¨¡ç‰ˆ (ä¿ç•™) ---
            { id: "new_01", mainCategory: "new_arrival", subCategory: "æ–°å“é å‘Š", title: "æ–°å“ï½œå±€éƒ¨åŠ‡é€çŒœçŒœçœ‹", platforms: ["instagram", "facebook"], tags: ["#æ–°å“é å‘Š", "#çŒœçŒœçœ‹"], content: "ğŸ‘€ å·çœ‹ä¸€çœ¼ï¼\né€™æ˜¯æˆ‘å€‘ç±Œå‚™äº† {æ™‚é–“} çš„ç§˜å¯†æ­¦å™¨...\n\nå¤§å®¶çŒœå¾—åˆ°é€™æ˜¯ä»€éº¼å—ï¼Ÿ\næç¤ºï¼š\n1. {æç¤ºä¸€}\n2. {æç¤ºäºŒ}\n\nçŒœå°çš„åº•ä¸‹ç•™è¨€ï¼Œå°ç·¨éš¨æ©ŸæŠ½ {çå“}ï¼ğŸ\n#æ–°å“é å‘Š #ComingSoon #ç¥ç§˜æ–°å“" },
            { id: "promo_01", mainCategory: "promotion", subCategory: "æ—©é³¥å„ªæƒ ", title: "ä¿ƒéŠ·ï½œæ—©é³¥é™æ™‚å„ªæƒ ", platforms: ["instagram", "facebook"], tags: ["#æ—©é³¥", "#å„ªæƒ "], content: "ğŸ¦ æ—©èµ·çš„é³¥å…’æœ‰èŸ²åƒï¼\n{æ´»å‹•åç¨±} æ—©é³¥å„ªæƒ é–‹è·‘ ğŸƒâ€â™‚ï¸\n\nå‰ {åé¡} åä¸‹å–®çš„æœ‹å‹ï¼Œ\né™¤äº†äº«æœ‰ {æŠ˜æ‰£} æŠ˜å„ªæƒ ï¼Œ\nå†åŠ é€ {è´ˆå“} ä¸€ä»½ï¼ğŸ\n\nåé¡æœ‰é™ï¼Œé€å®Œç‚ºæ­¢ï¼\nå¿«é»é€™è£¡æ¶è³¼ ğŸ‘‰ {é€£çµ}\n#æ—©é³¥å„ªæƒ  #é™æ™‚æ¶è³¼ #å¥½åº·" },
            { id: "greet_05", mainCategory: "greeting", subCategory: "è–èª•ç¯€", title: "ç¯€æ—¥ï½œè–èª•ç¯€äº¤æ›ç¦®ç‰©", platforms: ["instagram"], tags: ["#è–èª•ç¯€", "#ç¦®ç‰©"], content: "ğŸ„ Merry Christmas! ğŸ…\n\né‚„åœ¨ç…©æƒ±äº¤æ›ç¦®ç‰©é€ä»€éº¼å—ï¼Ÿ\né€ {å•†å“å} çµ•å°ä¸è¸©é›·ï¼ğŸ\n\nå¯¦ç”¨åˆå¯æ„›ï¼Œ\nä¿è­‰è®“æ”¶åˆ°çš„äººæœƒå¿ƒä¸€ç¬‘ï¼ğŸ¥°\nä»Šæ™šæº–å‚™å»å“ªè£¡æ…¶ç¥å‘¢ï¼Ÿâœ¨\n#è–èª•å¿«æ¨‚ #äº¤æ›ç¦®ç‰© #æº«é¦¨" },
            { id: "announce_01", mainCategory: "announcement", subCategory: "ä¼‘å‡å…¬å‘Š", title: "å…¬å‘Šï½œé€£å‡/å“¡æ—…å…¬ä¼‘", platforms: ["facebook", "instagram"], tags: ["#å…¬ä¼‘", "#æš«åœå‡ºè²¨"], content: "ğŸ“¢ã€å…¬ä¼‘å…¬å‘Šã€‘\n\næˆ‘å€‘è¦å»å……é›»å•¦ï¼ğŸ”‹\n{æ—¥æœŸèµ·} è‡³ {æ—¥æœŸè¿„}ï¼Œè³£å ´æš«åœå‡ºè²¨ã€å®¢æœæš«åœå›è¦†ã€‚\n\né€™æ®µæœŸé–“çš„è¨‚å–®ï¼Œå°‡æ–¼ {æ¢å¾©æ—¥æœŸ} ä¾åºå‡ºè²¨ã€‚\né€ æˆä¸ä¾¿è«‹è¦‹è«’ï¼Œç­‰æˆ‘å€‘å›ä¾†å–”ï¼â¤ï¸\n#å“¡å·¥æ—…éŠ #æ”¾å‡ #å……é›»ä¸­" },
        ];

        // --- å…¨åŸŸçµ„ä»¶å®šç¾© (é¿å… ReferenceError) ---
        const Footer = () => (
            <footer className="py-6 text-center text-slate-400 text-xs border-t border-slate-100 bg-white shrink-0">
                <div className="flex justify-center flex-wrap gap-3 mb-4 px-4">
                    <a href="https://www.instagram.com/ashunhouse/" target="_blank" rel="noreferrer" className="flex items-center gap-1.5 text-slate-500 hover:text-pink-600 transition-colors font-bold bg-slate-50 px-3 py-2 rounded-xl hover:bg-pink-50 border border-slate-100">
                        <Instagram className="w-4 h-4" /> IG
                    </a>
                    <a href="https://www.threads.net/@ashunhouse" target="_blank" rel="noreferrer" className="flex items-center gap-1.5 text-slate-500 hover:text-black transition-colors font-bold bg-slate-50 px-3 py-2 rounded-xl hover:bg-slate-200 border border-slate-100">
                        <AtSign className="w-4 h-4" /> Threads
                    </a>
                    <a href="https://myship.7-11.com.tw/general/detail/GM2511279067975" target="_blank" rel="noreferrer" className="flex items-center gap-1.5 text-slate-500 hover:text-green-600 transition-colors font-bold bg-slate-50 px-3 py-2 rounded-xl hover:bg-green-50 border border-slate-100">
                        <Package className="w-4 h-4" /> è³£è²¨ä¾¿
                    </a>
                    <a href="http://shopee.tw/ashunhouse" target="_blank" rel="noreferrer" className="flex items-center gap-1.5 text-slate-500 hover:text-orange-500 transition-colors font-bold bg-slate-50 px-3 py-2 rounded-xl hover:bg-orange-50 border border-slate-100">
                        <ShoppingBag className="w-4 h-4" /> è¦çš®è³£å ´
                    </a>
                </div>
                <p className="font-bold text-slate-500 mb-1">Powered by Ashun+ ç¤¾ç¾¤å·¥å…·</p>
                <p>é©åˆè²¼ç´™å“ç‰Œ / å°ç·¨ / è¦ªå­å¸³è™Ÿä½¿ç”¨ âœ¨</p>
            </footer>
        );

        const SocialMediaPlanner = () => {
            const [posts, setPosts] = useState(() => {
                try {
                    const saved = localStorage.getItem('socialPosts_v3');
                    return saved ? JSON.parse(saved) : [];
                } catch (e) { return []; }
            });

            const [productIdeas, setProductIdeas] = useState(() => {
                try {
                    const saved = localStorage.getItem('productIdeas_v2');
                    return saved ? JSON.parse(saved) : [];
                } catch (e) { return []; }
            });

            const [pastPosts, setPastPosts] = useState(() => {
                try {
                    const saved = localStorage.getItem('pastSocialPosts');
                    return saved ? JSON.parse(saved) : [];
                } catch (e) { return []; }
            });

            const [currentView, setCurrentView] = useState('home'); 
            const [isFormOpen, setIsFormOpen] = useState(false);
            const [isTemplateModalOpen, setIsTemplateModalOpen] = useState(false); 
            const [selectedTemplateCategory, setSelectedTemplateCategory] = useState('all');
            const [selectedTags, setSelectedTags] = useState([]); // æ–°å¢ï¼šé¸ä¸­çš„æ¨™ç±¤
            const [viewMode, setViewMode] = useState('grid');
            const [aiTone, setAiTone] = useState(null); 
            const [mobileTab, setMobileTab] = useState('schedule');

            const [apiKey, setApiKey] = useState(() => localStorage.getItem('gemini_api_key') || '');
            const [showApiKeyModal, setShowApiKeyModal] = useState(false);
            const [isOptimizing, setIsOptimizing] = useState(false);

            const [sidebarTab, setSidebarTab] = useState('social'); 
            const [quickIdea, setQuickIdea] = useState('');
            const [quickProductIdea, setQuickProductIdea] = useState('');
            const [quickPastPost, setQuickPastPost] = useState({ content: '', likes: '', comments: '' });
            
            const fileInputRef = useRef(null);
            const restoreInputRef = useRef(null);

            const [formData, setFormData] = useState({
                id: null,
                title: '',
                content: '', 
                shortContent: '', 
                platforms: ['instagram'], 
                date: '',
                time: '',
                status: 'draft',
                image: null,
                likes: '',
                comments: '',
                rating: 'normal' 
            });

            useEffect(() => {
                try { localStorage.setItem('socialPosts_v3', JSON.stringify(posts)); } catch (e) {}
            }, [posts]);

            useEffect(() => {
                try { localStorage.setItem('productIdeas_v2', JSON.stringify(productIdeas)); } catch (e) {}
            }, [productIdeas]);

            useEffect(() => {
                try { localStorage.setItem('pastSocialPosts', JSON.stringify(pastPosts)); } catch (e) {}
            }, [pastPosts]);

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData({ ...formData, [name]: value });
            };

            const togglePlatform = (platform) => {
                setFormData(prev => {
                    const current = prev.platforms || [];
                    if (current.includes(platform)) {
                        if (current.length === 1) return prev;
                        return { ...prev, platforms: current.filter(p => p !== platform) };
                    } else {
                        return { ...prev, platforms: [...current, platform] };
                    }
                });
            };

            const toggleTag = (tag) => {
                setSelectedTags(prev => {
                    if (prev.includes(tag)) return prev.filter(t => t !== tag);
                    return [...prev, tag];
                });
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const img = new Image();
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            const maxWidth = 800;
                            let width = img.width;
                            let height = img.height;
                            if (width > maxWidth) {
                                height = height * (maxWidth / width);
                                width = maxWidth;
                            }
                            canvas.width = width;
                            canvas.height = height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, width, height);
                            const dataUrl = canvas.toDataURL('image/jpeg', 0.7);
                            setFormData(prev => ({ ...prev, image: dataUrl }));
                        };
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            };

            const removeImage = () => {
                setFormData({ ...formData, image: null });
                if (fileInputRef.current) fileInputRef.current.value = '';
            };

            const addHashtag = (tag) => {
                setFormData(prev => ({
                    ...prev,
                    content: prev.content + (prev.content.endsWith(' ') || prev.content === '' ? '' : ' ') + tag
                }));
            };

            const saveApiKey = (key) => {
                localStorage.setItem('gemini_api_key', key);
                setApiKey(key);
                setShowApiKeyModal(false);
            };

            const optimizeContent = async (toneObj) => {
                if (!apiKey) {
                    setShowApiKeyModal(true);
                    return;
                }

                if (!formData.content.trim() && !formData.shortContent.trim()) {
                    alert("è«‹è‡³å°‘åœ¨å…¶ä¸­ä¸€å€‹æ¬„ä½è¼¸å…¥å…§å®¹è®“ AI å„ªåŒ–å–”ï¼");
                    return;
                }

                setAiTone(toneObj);
                setIsOptimizing(true);
                try {
                    const prompt = `
                    ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„ç¤¾ç¾¤å°ç·¨ã€‚è«‹æ ¹æ“šä»¥ä¸‹è¨­å®šå”åŠ©å„ªåŒ–è²¼æ–‡ã€‚

                    ã€å£å»è¨­å®šã€‘ï¼š${toneObj.label} (${toneObj.desc})
                    ã€å¹³å°ç‰¹æ€§ã€‘ï¼š
                    1. IG é•·æ–‡æ¡ˆï¼š${toneObj.platforms.includes('Instagram') || toneObj.platforms.includes('Facebook') ? 'è«‹ä¿ç•™å®Œæ•´æ¶æ§‹ã€è¡¨æƒ…ç¬¦è™Ÿè±å¯Œã€å¯åˆ†æ®µè½ã€‚' : 'è«‹æ ¹æ“šå£å»ç”Ÿæˆé©åˆInstagramçš„å®Œæ•´è²¼æ–‡ã€‚'}
                    2. Threads çŸ­æ–‡æ¡ˆï¼š${toneObj.platforms.includes('Threads') || toneObj.platforms.includes('é™å‹•') ? 'è«‹ç°¡çŸ­æœ‰åŠ›ã€å£èªåŒ–ã€å¼•ç™¼å…±é³´ã€é©åˆç¢ç¢å¿µæˆ–é‡‘å¥ã€‚' : 'è«‹æ ¹æ“šå£å»ç”Ÿæˆé©åˆThreadsçš„çŸ­æ–‡æ¡ˆã€‚'}

                    ã€åŸæ–‡è¼¸å…¥ã€‘ï¼š
                    IGé•·æ–‡æ¡ˆå€ï¼š${formData.content || '(ç„¡å…§å®¹ï¼Œè«‹æ ¹æ“šçŸ­æ–‡æ¡ˆç”Ÿæˆ)'}
                    ThreadsçŸ­æ–‡æ¡ˆå€ï¼š${formData.shortContent || '(ç„¡å…§å®¹ï¼Œè«‹æ ¹æ“šé•·æ–‡æ¡ˆç”Ÿæˆ)'}

                    ã€ä»»å‹™ã€‘ï¼š
                    è«‹åŒæ™‚å„ªåŒ–/ç”Ÿæˆ "IGé•·æ–‡æ¡ˆ" èˆ‡ "ThreadsçŸ­æ–‡æ¡ˆ"ã€‚è‹¥æŸæ¬„ä½ç‚ºç©ºï¼Œè«‹æ ¹æ“šå¦ä¸€æ¬„ä½çš„å…§å®¹èˆ‡å£å»è¨­å®šè‡ªå‹•ç”Ÿæˆã€‚
                    è«‹å‹™å¿…ä¿ç•™åŸæ–‡ä¸­çš„é—œéµè³‡è¨Šï¼ˆå¦‚ï¼š{è®Šæ•¸}ã€æ™‚é–“ã€åœ°é»ã€é€£çµï¼‰ã€‚

                    ã€è¼¸å‡ºæ ¼å¼ã€‘ï¼š
                    è«‹åƒ…å›å‚³ä¸€å€‹ JSON ç‰©ä»¶ï¼Œæ ¼å¼å¦‚ä¸‹ï¼ˆä¸è¦æœ‰ markdown æ¨™è¨˜ï¼‰ï¼š
                    {
                        "ig_content": "å„ªåŒ–å¾Œçš„IGé•·æ–‡æ¡ˆå…§å®¹",
                        "threads_content": "å„ªåŒ–å¾Œçš„ThreadsçŸ­æ–‡æ¡ˆå…§å®¹"
                    }
                    `;

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });

                    const data = await response.json();
                    if (data.candidates && data.candidates[0].content) {
                        let resultText = data.candidates[0].content.parts[0].text;
                        resultText = resultText.replace(/```json/g, '').replace(/```/g, '').trim();
                        
                        try {
                            const resultJson = JSON.parse(resultText);
                            setFormData(prev => ({ 
                                ...prev, 
                                content: resultJson.ig_content || prev.content,
                                shortContent: resultJson.threads_content || prev.shortContent
                            }));
                            alert("âœ¨ AI å„ªåŒ–å®Œæˆï¼å·²åŒæ™‚æ›´æ–°é•·çŸ­æ–‡æ¡ˆã€‚");
                        } catch (e) {
                            console.error("JSON Parse Error:", e);
                            alert("ğŸ˜“ AI å›å‚³æ ¼å¼æœ‰é»å•é¡Œï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚");
                        }
                    } else {
                        throw new Error("API å›å‚³æ ¼å¼éŒ¯èª¤æˆ–é‡‘é‘°ç„¡æ•ˆ");
                    }
                } catch (error) {
                    console.error("AI Error:", error);
                    alert("ğŸ˜“ AI é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ API Key æ˜¯å¦æ­£ç¢ºï¼Œæˆ–ç¨å¾Œå†è©¦ã€‚");
                    setShowApiKeyModal(true); 
                } finally {
                    setIsOptimizing(false);
                }
            };

            const pickRandomTemplate = () => {
                const threadsCategories = ['th_chat', 'th_growth', 'th_brand', 'th_obs', 'th_prod', 'th_emo'];
                const candidates = TEMPLATE_LIBRARY.filter(t => threadsCategories.includes(t.mainCategory));
                const pool = candidates.length > 0 ? candidates : TEMPLATE_LIBRARY;
                const randomTemplate = pool[Math.floor(Math.random() * pool.length)];
                applyLibraryTemplate(randomTemplate);
            };

            const applyLibraryTemplate = (template) => {
                const newPost = {
                    id: Date.now(),
                    title: template.title,
                    content: template.content, 
                    shortContent: template.platforms.includes('threads') ? template.content : '', 
                    platforms: template.platforms || ['instagram'],
                    date: '',
                    time: '',
                    status: 'draft', 
                    image: null,
                    likes: '',
                    comments: '',
                    rating: 'normal'
                };
                
                setPosts([newPost, ...posts]); 
                setIsTemplateModalOpen(false); 
                setFormData(newPost);
                setIsFormOpen(true);
                setCurrentView('planner');
            };

            const handleBackup = () => {
                const data = { posts, productIdeas, pastPosts };
                const element = document.createElement("a");
                const file = new Blob([JSON.stringify(data)], {type: 'application/json'});
                element.href = URL.createObjectURL(file);
                element.download = `Ashun_Backup_${new Date().toISOString().slice(0,10)}.json`;
                document.body.appendChild(element);
                element.click();
                document.body.removeChild(element);
            };

            const handleRestore = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (confirm('ç¢ºå®šè¦é‚„åŸå‚™ä»½å—ï¼Ÿé€™å°‡æœƒè¦†è“‹ç›®å‰çš„è³‡æ–™ï¼')) {
                            setPosts(data.posts || []);
                            setProductIdeas(data.productIdeas || []);
                            setPastPosts(data.pastPosts || []);
                            alert('ğŸ‰ è³‡æ–™é‚„åŸæˆåŠŸï¼');
                        }
                    } catch (err) { alert('è³‡æ–™æ ¼å¼éŒ¯èª¤ï¼Œç„¡æ³•é‚„åŸ ğŸ˜¢'); }
                };
                reader.readAsText(file);
            };

            const handleExport = () => {
                if (scheduledPosts.length === 0) {
                    alert('ç›®å‰æ²’æœ‰å·²æ’ç¨‹çš„è²¼æ–‡å¯ä»¥åŒ¯å‡ºå–”ï¼');
                    return;
                }
                let exportText = "ğŸ“… Ashun+ ç¤¾ç¾¤è²¼æ–‡é€±å ±\n=========================\n\n";
                scheduledPosts.forEach((post, index) => {
                    exportText += `ã€è²¼æ–‡ ${index + 1}ã€‘${post.title || 'ç„¡æ¨™é¡Œ'}\n`;
                    exportText += `â° æ™‚é–“ï¼š${post.date || 'æœªå®š'} ${post.time || ''}\n`;
                    exportText += `ğŸ“± å¹³å°ï¼š${post.platforms ? post.platforms.join(', ') : post.platform}\n`;
                    exportText += `ğŸ“Š ç‹€æ…‹ï¼š${getStatusLabel(post.status)}\n`;
                    if (post.status === 'published') {
                        exportText += `ğŸ“ˆ æˆæ•ˆï¼šâ¤ï¸ ${post.likes || 0} | ğŸ’¬ ${post.comments || 0}\n`;
                    }
                    exportText += `-------------------------\n`;
                    exportText += `[IG é•·æ–‡æ¡ˆ]\n${post.content}\n\n`;
                    if (post.shortContent) {
                        exportText += `[Threads çŸ­æ–‡æ¡ˆ]\n${post.shortContent}\n`;
                    }
                    exportText += `\n=========================\n\n`;
                });
                const element = document.createElement("a");
                const file = new Blob([exportText], {type: 'text/plain'});
                element.href = URL.createObjectURL(file);
                element.download = `AshunPlus_ç¤¾ç¾¤é€±å ±_${new Date().toISOString().slice(0,10)}.txt`;
                document.body.appendChild(element);
                element.click();
                document.body.removeChild(element);
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (formData.id) {
                    setPosts(posts.map(post => post.id === formData.id ? formData : post));
                } else {
                    setPosts([...posts, { ...formData, id: Date.now() }]);
                }
                setIsFormOpen(false);
                resetForm();
            };

            const handleQuickIdeaSubmit = (e) => {
                e.preventDefault();
                if (!quickIdea.trim()) return;
                const newIdea = {
                    id: Date.now(),
                    title: quickIdea.split('\n')[0].substring(0, 20) + (quickIdea.length > 20 ? '...' : ''), 
                    content: quickIdea,
                    shortContent: '',
                    platforms: ['instagram'],
                    date: '',
                    time: '',
                    status: 'idea',
                    image: null
                };
                setPosts([newIdea, ...posts]);
                setQuickIdea('');
            };

            const handleQuickProductSubmit = (e) => {
                e.preventDefault();
                if (!quickProductIdea.trim()) return;
                setProductIdeas([{ id: Date.now(), content: quickProductIdea }, ...productIdeas]);
                setQuickProductIdea('');
            };

            const handleQuickPastPostSubmit = (e) => {
                e.preventDefault();
                if (!quickPastPost.content.trim()) return;
                const newPastPost = {
                    id: Date.now(),
                    content: quickPastPost.content,
                    likes: quickPastPost.likes || 0,
                    comments: quickPastPost.comments || 0,
                    date: new Date().toISOString().slice(0,10)
                };
                setPastPosts([newPastPost, ...pastPosts]);
                setQuickPastPost({ content: '', likes: '', comments: '' });
            };

            const handleReusePastPost = (post) => {
                setFormData({
                    ...formData,
                    content: post.content,
                    shortContent: '', 
                    status: 'draft' 
                });
                setIsFormOpen(true);
            };

            const handleDelete = (id) => {
                if (window.confirm('ç¢ºå®šè¦åˆªé™¤é€™å‰‡è²¼æ–‡ç´€éŒ„å—ï¼Ÿ')) {
                    setPosts(posts.filter(post => post.id !== id));
                }
            };

            const handleDeleteProduct = (id) => {
                if (window.confirm('ç¢ºå®šè¦åˆªé™¤é€™å‰‡ç”¢å“éˆæ„Ÿå—ï¼Ÿ')) {
                    setProductIdeas(productIdeas.filter(p => p.id !== id));
                }
            };

            const handleDeletePastPost = (id) => {
                if (window.confirm('ç¢ºå®šè¦åˆªé™¤é€™å‰‡éå¾€ç´€éŒ„å—ï¼Ÿ')) {
                    setPastPosts(pastPosts.filter(p => p.id !== id));
                }
            };

            const handleEdit = (post) => {
                setFormData({ ...post });
                setIsFormOpen(true);
            };

            const handleScheduleIdea = (post) => {
                setFormData({ ...post, status: 'draft', shortContent: post.shortContent || '' });
                setIsFormOpen(true);
            };

            const resetForm = (platform = 'instagram') => {
                setFormData({
                    id: null,
                    title: '',
                    content: '',
                    shortContent: '',
                    platforms: [platform],
                    date: '',
                    time: '',
                    status: 'draft',
                    image: null,
                    likes: '',
                    comments: '',
                    rating: 'normal'
                });
                setAiTone(null);
            };

            const copyContent = (content) => {
                navigator.clipboard.writeText(content);
                alert('ğŸ‰ å·²è¤‡è£½ï¼');
            };

            const handleScenarioClick = (scenario) => {
                setCurrentView('planner');
                if (scenario === 'story') {
                    resetForm('instagram');
                    setIsFormOpen(true);
                } else if (scenario === 'threads_hub') {
                    setSelectedTemplateCategory('th_chat');
                    setSelectedTags([]); 
                    setIsTemplateModalOpen(true);
                } else if (scenario === 'new_arrival' || scenario === 'promotion' || scenario === 'greeting') {
                    setSelectedTemplateCategory(scenario);
                    setIsTemplateModalOpen(true);
                } else if (scenario === 'announcement') {
                    resetForm('facebook');
                    setFormData(prev => ({ ...prev, title: 'ğŸ“¢ é‡è¦å…¬å‘Šï¼š' }));
                    setIsFormOpen(true);
                }
            };

            const filteredTemplates = useMemo(() => {
                let templates = TEMPLATE_LIBRARY;
                if (selectedTemplateCategory !== 'all') {
                    templates = templates.filter(t => t.mainCategory === selectedTemplateCategory);
                }
                if (selectedTags.length > 0) {
                    templates = templates.filter(t => {
                        return selectedTags.some(tag => t.tags && t.tags.includes(tag));
                    });
                }
                return templates;
            }, [selectedTemplateCategory, selectedTags]);

            // --- ä¿®å¾©è®Šæ•¸å®šç¾© (Added Missing Variables) ---
            const ideaPosts = posts.filter(post => post.status === 'idea');
            const scheduledPosts = posts
                .filter(post => post.status !== 'idea')
                .sort((a, b) => {
                    const dateA = a.date ? new Date(`${a.date}T${a.time || '00:00'}`) : new Date(9999, 11, 31);
                    const dateB = b.date ? new Date(`${b.date}T${b.time || '00:00'}`) : new Date(9999, 11, 31);
                    return dateA - dateB;
                });
            // ----------------------------------------------

            const getPlatformIcon = (platform, size = "w-5 h-5") => {
                switch (platform) {
                    case 'instagram': return <Instagram className={`${size} text-pink-600`} />;
                    case 'facebook': return <Facebook className={`${size} text-blue-600`} />;
                    case 'threads': return <AtSign className={`${size} text-black`} />;
                    default: return <Instagram className={size} />;
                }
            };
            
            const getPlatformLabel = (p) => {
                if(p==='instagram') return 'IG';
                if(p==='facebook') return 'FB';
                if(p==='threads') return 'Threads';
                return p;
            };

            const getStatusColor = (status) => {
                switch (status) {
                    case 'draft': return 'bg-gray-100 text-gray-800 border-gray-200';
                    case 'scheduled': return 'bg-blue-100 text-blue-800 border-blue-200';
                    case 'published': return 'bg-green-100 text-green-800 border-green-200';
                    default: return 'bg-gray-100';
                }
            };

            const getStatusLabel = (status) => {
                switch (status) {
                    case 'draft': return 'è‰ç¨¿';
                    case 'scheduled': return 'å·²æ’ç¨‹';
                    case 'published': return 'å·²ç™¼å¸ƒ';
                    default: return status;
                }
            };

            // Components
            const ApiKeyModal = () => (
                <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[60] flex justify-center items-center p-4">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 animate-[fadeIn_0.2s_ease-out]">
                        <h3 className="text-xl font-bold text-slate-800 mb-2 flex items-center gap-2">
                            <Sparkles className="w-5 h-5 text-indigo-600" />
                            è¨­å®š Gemini AI é‡‘é‘°
                        </h3>
                        <p className="text-slate-500 text-sm mb-4">ç‚ºäº†ä½¿ç”¨ AI å„ªåŒ–åŠŸèƒ½ï¼Œè«‹è¼¸å…¥æ‚¨çš„ Google Gemini API Keyã€‚é‡‘é‘°å°‡åƒ…å„²å­˜åœ¨æ‚¨çš„ç€è¦½å™¨ä¸­ã€‚</p>
                        <input 
                            type="password" 
                            placeholder="è²¼ä¸Šæ‚¨çš„ API Key" 
                            className="w-full p-3 border border-slate-300 rounded-xl mb-4 focus:ring-2 focus:ring-indigo-500 outline-none"
                            defaultValue={apiKey}
                            onBlur={(e) => saveApiKey(e.target.value)}
                        />
                        <div className="flex gap-2 justify-end">
                            <button onClick={() => setShowApiKeyModal(false)} className="px-4 py-2 text-slate-500 hover:bg-slate-100 rounded-lg">é—œé–‰</button>
                            <a href="https://aistudio.google.com/app/apikey" target="_blank" className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">å–å¾—å…è²» Key</a>
                        </div>
                    </div>
                </div>
            );

            // Home View Component
            const HomeView = () => (
                <div className="flex-1 flex flex-col items-center justify-center p-4 bg-gradient-to-b from-indigo-50/50 to-white overflow-y-auto fade-in">
                    <div className="max-w-5xl w-full">
                        <div className="text-center mb-6">
                            <h1 className="text-2xl md:text-3xl font-bold text-slate-800 mb-2">ğŸ‰ ä»Šå¤©æƒ³ç™¼ä»€éº¼æ–‡ï¼Ÿ</h1>
                            <p className="text-slate-500 text-sm">Ashun+ å¹«ä½ å¿«é€Ÿæå®šç¤¾ç¾¤æ’ç¨‹</p>
                        </div>

                        {/* å„ªåŒ– 1ï¼šéš¨æ©Ÿé¸ä¸€å‰‡æŒ‰éˆ• */}
                        <div className="flex justify-center mb-8">
                            <button 
                                onClick={pickRandomTemplate}
                                className="group relative bg-white border-2 border-slate-900 text-slate-900 px-6 py-4 rounded-2xl shadow-[4px_4px_0px_0px_rgba(15,23,42,1)] hover:shadow-[2px_2px_0px_0px_rgba(15,23,42,1)] hover:translate-x-[2px] hover:translate-y-[2px] transition-all flex items-center gap-3 active:scale-95"
                            >
                                <div className="bg-yellow-300 p-2 rounded-lg border-2 border-slate-900 group-hover:rotate-12 transition-transform">
                                    <Dice className="w-6 h-6" />
                                </div>
                                <div className="text-left">
                                    <h3 className="font-bold text-lg leading-tight">ä»Šå¤©ä¸çŸ¥é“ç™¼ä»€éº¼ï¼Ÿ</h3>
                                    <p className="text-xs text-slate-500 font-bold">ğŸ² å¹«æˆ‘éš¨æ©Ÿé¸ä¸€å‰‡ Threads å»¢æ–‡</p>
                                </div>
                                <div className="absolute -top-3 -right-3 bg-red-500 text-white text-[10px] font-bold px-2 py-1 rounded-full animate-bounce">
                                    æ¨ï¼
                                </div>
                            </button>
                        </div>

                        {/* Scenario Grid */}
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                            {/* 1. Threads å°ˆå€ (Highlight) */}
                            <button 
                                onClick={() => handleScenarioClick('threads_hub')}
                                className="bg-gradient-to-br from-stone-50 to-stone-100 p-4 rounded-xl shadow-sm border border-stone-200 hover:shadow-lg hover:-translate-y-1 transition-all flex flex-col items-center gap-2 group col-span-2 md:col-span-2 relative overflow-hidden"
                            >
                                <div className="absolute top-0 right-0 bg-black text-white text-[10px] px-2 py-1 rounded-bl-lg font-bold">æ—¥æ›´ç¥å™¨</div>
                                <div className="bg-white p-3 rounded-full group-hover:scale-110 transition-transform shadow-sm">
                                    <AtSign className="w-8 h-8 text-black" />
                                </div>
                                <div>
                                    <h3 className="font-bold text-slate-800 text-lg">ğŸ§µ Threads å°ç·¨èŠå¤©å®¤</h3>
                                    <p className="text-xs text-slate-500">æ²’éˆæ„Ÿï¼Ÿä¾†é€™è£¡æ‰¾è©±é¡ŒèŠå¤©ï¼</p>
                                </div>
                            </button>

                            {/* 2. æ–°å“/ä¿ƒéŠ· */}
                            <button 
                                onClick={() => handleScenarioClick('new_arrival')}
                                className="bg-white p-4 rounded-xl shadow-sm border border-slate-100 hover:shadow-lg hover:-translate-y-1 transition-all flex flex-col items-center gap-2 group"
                            >
                                <div className="bg-gradient-to-br from-purple-100 to-green-100 p-3 rounded-full group-hover:from-purple-200 group-hover:to-green-200 transition-colors">
                                    <ShoppingBag className="w-6 h-6 text-slate-700" />
                                </div>
                                <div>
                                    <h3 className="font-bold text-slate-700 text-sm md:text-base">âœ¨ æ–°å“/ä¿ƒéŠ·</h3>
                                    <p className="text-[10px] text-slate-400 hidden md:block">ä¸Šæ¶é å‘Šã€é™æ™‚å„ªæƒ </p>
                                </div>
                            </button>

                            {/* 3. ç¯€æ…¶ç¥ç¦ */}
                            <button 
                                onClick={() => handleScenarioClick('greeting')}
                                className="bg-white p-4 rounded-xl shadow-sm border border-slate-100 hover:shadow-lg hover:-translate-y-1 transition-all flex flex-col items-center gap-2 group"
                            >
                                <div className="bg-red-100 p-3 rounded-full group-hover:bg-red-200 transition-colors">
                                    <Gift className="w-6 h-6 text-red-600" />
                                </div>
                                <div>
                                    <h3 className="font-bold text-slate-700 text-sm md:text-base">â¤ï¸ ç¯€æ…¶ç¥ç¦</h3>
                                    <p className="text-[10px] text-slate-400 hidden md:block">æº«æš–å•å€™ï¼Œæ‹‰è¿‘è·é›¢</p>
                                </div>
                            </button>
                        </div>
                        
                        {/* Secondary Row */}
                        <div className="grid grid-cols-2 gap-4 max-w-lg mx-auto">
                             <button 
                                onClick={() => handleScenarioClick('announcement')}
                                className="bg-white p-3 rounded-xl shadow-sm border border-slate-100 hover:shadow-md hover:-translate-y-0.5 transition-all flex items-center justify-center gap-2 group"
                            >
                                <Megaphone className="w-5 h-5 text-blue-500" />
                                <span className="font-bold text-slate-600 text-sm">ğŸ“¢ é‡è¦ä½ˆå‘Š</span>
                            </button>
                             <button 
                                onClick={() => {resetForm(); setIsFormOpen(true);}}
                                className="bg-white p-3 rounded-xl shadow-sm border border-slate-100 hover:shadow-md hover:-translate-y-0.5 transition-all flex items-center justify-center gap-2 group"
                            >
                                <Edit2 className="w-5 h-5 text-slate-400" />
                                <span className="font-bold text-slate-600 text-sm">ğŸ“ ç©ºç™½è‰ç¨¿</span>
                            </button>
                        </div>

                        <div className="mt-6 text-center">
                            <button 
                                onClick={() => setCurrentView('planner')}
                                className="text-slate-400 hover:text-indigo-600 text-xs font-medium flex items-center justify-center gap-1 transition-colors"
                            >
                                ç›´æ¥é€²å…¥æ’ç¨‹è¡¨ <ArrowRight className="w-3 h-3" />
                            </button>
                        </div>
                    </div>
                </div>
            );

            if (currentView === 'home') {
                return (
                    <div className="h-screen flex flex-col font-sans">
                        <HomeView />
                        <Footer />
                        {showApiKeyModal && <ApiKeyModal />}
                    </div>
                );
            }

            return (
                <div className="h-screen flex flex-col font-sans">
                    {/* Header */}
                    <header className="bg-white border-b border-slate-200 shrink-0 z-20 shadow-sm sticky top-0">
                        <div className="max-w-[1600px] mx-auto px-4 py-3 flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <button onClick={() => setCurrentView('home')} className="p-2 hover:bg-slate-100 rounded-full text-slate-400 hover:text-slate-600 transition-colors" title="å›é¦–é ">
                                    <ArrowLeft className="w-5 h-5" />
                                </button>
                                <div className="flex items-center gap-2">
                                    <div className="bg-gradient-to-br from-indigo-600 to-purple-600 p-2 rounded-lg shadow-md shadow-indigo-200 hidden sm:block">
                                        <Calendar className="w-5 h-5 text-white" />
                                    </div>
                                    <h1 className="text-lg md:text-xl font-bold text-slate-800">Ashun+ æ’ç¨‹</h1>
                                </div>
                            </div>
                            <div className="flex items-center gap-2">
                                <button onClick={handleBackup} className="p-2 hover:bg-slate-100 text-slate-400 hover:text-slate-600 rounded-full transition-colors" title="å‚™ä»½è³‡æ–™">
                                    <Archive className="w-5 h-5" />
                                </button>
                                <button onClick={() => restoreInputRef.current.click()} className="p-2 hover:bg-slate-100 text-slate-400 hover:text-slate-600 rounded-full transition-colors" title="é‚„åŸè³‡æ–™">
                                    <Upload className="w-5 h-5" />
                                </button>
                                <input type="file" ref={restoreInputRef} onChange={handleRestore} className="hidden" accept=".json" />

                                <button onClick={handleExport} className="hidden sm:flex bg-white hover:bg-slate-50 text-slate-600 border border-slate-200 px-3 py-2 rounded-full items-center gap-2 shadow-sm transition-all text-sm font-bold">
                                    <Download className="w-4 h-4" /> <span>åŒ¯å‡º</span>
                                </button>
                                <button onClick={() => setShowApiKeyModal(true)} className="p-2 hover:bg-slate-100 text-slate-400 rounded-full transition-colors" title="AI è¨­å®š">
                                    <Settings className="w-5 h-5" />
                                </button>
                                <button onClick={() => { resetForm(); setIsFormOpen(true); }} className="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-full flex items-center gap-2 shadow-lg transition-all active:scale-95 text-sm font-medium">
                                    <Plus className="w-4 h-4" /> <span className="hidden sm:inline">æ–°å¢</span>
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* Main Layout */}
                    <div className="flex-1 flex flex-col md:flex-row overflow-hidden max-w-[1600px] mx-auto w-full relative">
                        {/* Sidebar */}
                        <aside className={`w-full md:w-80 bg-slate-50 border-b md:border-b-0 md:border-r border-slate-200 flex flex-col shrink-0 h-full md:h-full transition-all absolute md:relative z-0 ${mobileTab === 'ideas' ? 'flex' : 'hidden md:flex'}`}>
                            <div className="bg-white border-b border-slate-200 shadow-sm z-10 shrink-0">
                                <div className="p-3">
                                    <div className="flex p-1 bg-slate-100 rounded-lg">
                                        <button onClick={() => setSidebarTab('social')} className={`flex-1 py-1.5 text-xs md:text-sm font-bold rounded-md flex items-center justify-center gap-2 transition-all ${sidebarTab === 'social' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>
                                            <Edit2 className="w-3.5 h-3.5" /> è²¼æ–‡
                                            <span className="bg-slate-100 text-slate-600 text-[10px] px-1.5 rounded-full ml-1">{ideaPosts.length}</span>
                                        </button>
                                        <button onClick={() => setSidebarTab('product')} className={`flex-1 py-1.5 text-xs md:text-sm font-bold rounded-md flex items-center justify-center gap-2 transition-all ${sidebarTab === 'product' ? 'bg-white text-emerald-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>
                                            <Package className="w-3.5 h-3.5" /> ç”¢å“
                                            <span className="bg-slate-100 text-slate-600 text-[10px] px-1.5 rounded-full ml-1">{productIdeas.length}</span>
                                        </button>
                                        <button onClick={() => setSidebarTab('past_ref')} className={`flex-1 py-1.5 text-xs md:text-sm font-bold rounded-md flex items-center justify-center gap-2 transition-all ${sidebarTab === 'past_ref' ? 'bg-white text-slate-800 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>
                                            <Archive className="w-3.5 h-3.5" /> è³‡æ–™åº«
                                        </button>
                                    </div>
                                </div>

                                <div className="p-3 pt-0">
                                    {sidebarTab === 'social' ? (
                                        <>
                                            <form onSubmit={handleQuickIdeaSubmit} className="relative mb-3">
                                                <textarea value={quickIdea} onChange={(e) => setQuickIdea(e.target.value)} placeholder="æƒ³åˆ°ä»€éº¼è²¼æ–‡ï¼Ÿå…ˆè¨˜ä¸‹ä¾†..." className="w-full p-3 pr-10 bg-slate-100 border-none rounded-xl focus:ring-2 focus:ring-indigo-500 focus:bg-white transition-all text-sm resize-none h-16 placeholder:text-slate-400"></textarea>
                                                <button type="submit" disabled={!quickIdea.trim()} className="absolute bottom-2 right-2 p-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm transition-all"><Plus className="w-4 h-4" /></button>
                                            </form>
                                            <button onClick={() => setIsTemplateModalOpen(true)} className="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-indigo-50 to-purple-50 border border-indigo-100 text-indigo-700 px-3 py-2 rounded-xl text-xs font-bold hover:shadow-md transition-all hover:-translate-y-0.5 group">
                                                <Book className="w-4 h-4 text-indigo-500 group-hover:scale-110 transition-transform" /> ğŸ“š æ‰“é–‹æ–‡æ¡ˆæ¨¡æ¿åº«
                                            </button>
                                        </>
                                    ) : sidebarTab === 'product' ? (
                                        <form onSubmit={handleQuickProductSubmit} className="relative">
                                            <textarea value={quickProductIdea} onChange={(e) => setQuickProductIdea(e.target.value)} placeholder="æ–°ç”¢å“é»å­..." className="w-full p-3 pr-10 bg-emerald-50 border-none rounded-xl focus:ring-2 focus:ring-emerald-500 focus:bg-white transition-all text-sm resize-none h-16 placeholder:text-emerald-700/50 text-emerald-900"></textarea>
                                            <button type="submit" disabled={!quickProductIdea.trim()} className="absolute bottom-2 right-2 p-1.5 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm transition-all"><Plus className="w-4 h-4" /></button>
                                        </form>
                                    ) : (
                                        <form onSubmit={handleQuickPastPostSubmit} className="relative space-y-2">
                                            <textarea value={quickPastPost.content} onChange={(e) => setQuickPastPost({ ...quickPastPost, content: e.target.value })} placeholder="è²¼ä¸Šéå¾€çš„å¥½è²¼æ–‡..." className="w-full p-3 bg-slate-100 border-none rounded-xl focus:ring-2 focus:ring-slate-500 focus:bg-white transition-all text-sm resize-none h-16 placeholder:text-slate-400"></textarea>
                                            <div className="flex gap-2">
                                                <input type="number" placeholder="è®šæ•¸" value={quickPastPost.likes} onChange={(e) => setQuickPastPost({ ...quickPastPost, likes: e.target.value })} className="w-1/2 p-2 text-xs bg-slate-50 border border-slate-200 rounded-lg" />
                                                <input type="number" placeholder="ç•™è¨€æ•¸" value={quickPastPost.comments} onChange={(e) => setQuickPastPost({ ...quickPastPost, comments: e.target.value })} className="w-1/2 p-2 text-xs bg-slate-50 border border-slate-200 rounded-lg" />
                                                <button type="submit" disabled={!quickPastPost.content.trim()} className="p-2 bg-slate-800 text-white rounded-lg hover:bg-slate-700 disabled:opacity-50"><Plus className="w-4 h-4" /></button>
                                            </div>
                                        </form>
                                    )}
                                </div>
                            </div>

                            <div className="flex-1 overflow-y-auto p-3 space-y-3 custom-scrollbar bg-slate-50/50 pb-20 md:pb-4">
                                {sidebarTab === 'social' ? (
                                    ideaPosts.length === 0 ? (
                                        <div className="text-center py-8 text-slate-400 text-xs"><p>éˆæ„Ÿæ¯ç«­äº†å—ï¼Ÿ<br/>å¿«å»æ¨¡æ¿åº«æ‰¾éˆæ„Ÿï¼</p></div>
                                    ) : (
                                        ideaPosts.map(idea => (
                                            <div key={idea.id} className="bg-white p-3 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-all group">
                                                <p className="text-slate-800 text-sm whitespace-pre-wrap line-clamp-3 font-medium mb-2">{idea.content}</p>
                                                <div className="flex justify-between items-center pt-2 border-t border-slate-50">
                                                    <button onClick={() => handleDelete(idea.id)} className="text-slate-400 hover:text-red-500 p-1"><Trash2 className="w-3.5 h-3.5" /></button>
                                                    <button onClick={() => handleScheduleIdea(idea)} className="flex items-center gap-1 text-xs font-bold text-indigo-600 bg-indigo-50 hover:bg-indigo-100 px-2 py-1 rounded-md transition-colors">å»æ’ç¨‹ <ArrowRight className="w-3 h-3" /></button>
                                                </div>
                                            </div>
                                        ))
                                    )
                                ) : sidebarTab === 'product' ? (
                                    productIdeas.length === 0 ? (
                                        <div className="text-center py-8 text-slate-400 text-xs"><p>é‚„æ²’æœ‰ç”¢å“é»å­ï¼Ÿ<br/>ç´€éŒ„ä¸‹ä¸€å€‹çˆ†æ¬¾å•†å“å§ï¼</p></div>
                                    ) : (
                                        productIdeas.map(product => (
                                            <div key={product.id} className="bg-emerald-50/50 p-3 rounded-xl border border-emerald-100 shadow-sm hover:shadow-md transition-all group">
                                                <p className="text-emerald-900 text-sm whitespace-pre-wrap line-clamp-3 font-medium mb-2">{product.content}</p>
                                                <div className="flex justify-between items-center pt-2 border-t border-emerald-100">
                                                    <button onClick={() => handleDeleteProduct(product.id)} className="text-emerald-400 hover:text-red-500 p-1"><Trash2 className="w-3.5 h-3.5" /></button>
                                                    <button onClick={() => copyContent(product.content)} className="text-xs font-bold text-emerald-600 hover:text-emerald-800 flex items-center gap-1 px-2 py-1 rounded hover:bg-emerald-100 transition-colors"><Copy className="w-3 h-3" /> è¤‡è£½</button>
                                                </div>
                                            </div>
                                        ))
                                    )
                                ) : (
                                    pastPosts.length === 0 ? (
                                        <div className="text-center py-8 text-slate-400 text-xs"><p>é‚„æ²’æœ‰éå¾€ç´€éŒ„ï¼Ÿ<br/>æŠŠè¡¨ç¾å¥½çš„è²¼æ–‡å­˜é€²ä¾†å§ï¼</p></div>
                                    ) : (
                                        pastPosts.map(post => (
                                            <div key={post.id} className="bg-slate-100 p-3 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-all group">
                                                <p className="text-slate-700 text-sm whitespace-pre-wrap line-clamp-3 font-medium mb-2">{post.content}</p>
                                                <div className="flex gap-2 mb-2 text-[10px] text-slate-500 font-bold">
                                                    <span className="flex items-center gap-0.5"><Heart className="w-3 h-3" /> {post.likes}</span>
                                                    <span className="flex items-center gap-0.5"><MessageCircle className="w-3 h-3" /> {post.comments}</span>
                                                </div>
                                                <div className="flex justify-between items-center pt-2 border-t border-slate-200">
                                                    <button onClick={() => handleDeletePastPost(post.id)} className="text-slate-400 hover:text-red-500 p-1"><Trash2 className="w-3.5 h-3.5" /></button>
                                                    <button onClick={() => handleReusePastPost(post)} className="flex items-center gap-1 text-xs font-bold text-slate-600 bg-white border border-slate-300 hover:bg-slate-50 px-2 py-1 rounded-md transition-colors shadow-sm"><Copy className="w-3 h-3" /> å¼•ç”¨</button>
                                                </div>
                                            </div>
                                        ))
                                    )
                                )}
                            </div>
                        </aside>

                        {/* Main Content ... (Same) */}
                        <main className={`flex-1 flex flex-col h-full md:h-full overflow-hidden bg-white relative z-0 transition-all ${mobileTab === 'schedule' ? 'flex' : 'hidden md:flex'}`}>
                            {/* Toolbar */}
                            <div className="p-3 border-b border-slate-100 flex justify-between items-center gap-3 bg-white">
                                <h2 className="text-sm font-bold text-slate-500 flex items-center gap-2">
                                    <span className="w-2 h-2 rounded-full bg-indigo-500"></span>
                                    å·²æ’ç¨‹ ({scheduledPosts.length})
                                </h2>
                                <div className="flex items-center gap-1 bg-slate-100 p-1 rounded-lg">
                                    <button onClick={() => setViewMode('grid')} className={`p-1.5 rounded-md transition-all ${viewMode === 'grid' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-400 hover:text-slate-600'}`}><LayoutGrid className="w-4 h-4" /></button>
                                    <button onClick={() => setViewMode('list')} className={`p-1.5 rounded-md transition-all ${viewMode === 'list' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-400 hover:text-slate-600'}`}><ListIcon className="w-4 h-4" /></button>
                                </div>
                            </div>

                            {/* Content */}
                            <div className="flex-1 overflow-y-auto p-4 md:p-6 bg-slate-50/30 custom-scrollbar pb-20 md:pb-6">
                                {scheduledPosts.length === 0 ? (
                                    <div className="h-full flex flex-col items-center justify-center text-slate-400 p-8">
                                        <div className="max-w-md w-full text-center">
                                            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 mb-6">
                                                <h3 className="text-lg font-bold text-slate-800 mb-4 flex items-center justify-center gap-2"><span className="text-2xl">ğŸš€</span> 3 æ­¥é©Ÿå¿«é€Ÿä¸Šæ‰‹</h3>
                                                <div className="space-y-4 text-left">
                                                    <div className="flex items-start gap-3">
                                                        <div className="bg-indigo-100 text-indigo-600 w-6 h-6 rounded-full flex items-center justify-center font-bold text-sm shrink-0 mt-0.5">1</div>
                                                        <div><p className="font-bold text-slate-700 text-sm">å·¦å´è¨˜éŒ„éˆæ„Ÿ</p><p className="text-xs text-slate-500">ä¸ç”¨æ€¥è‘—æ’ç¨‹ï¼Œå…ˆæŠŠè…¦ä¸­çš„é»å­å¯«ä¸‹ä¾†ï¼Œæˆ–æ˜¯ä½¿ç”¨ã€Œæ¨¡æ¿åº«ã€å¿«é€Ÿç”Ÿæˆã€‚</p></div>
                                                    </div>
                                                    <div className="flex items-start gap-3">
                                                        <div className="bg-indigo-100 text-indigo-600 w-6 h-6 rounded-full flex items-center justify-center font-bold text-sm shrink-0 mt-0.5">2</div>
                                                        <div><p className="font-bold text-slate-700 text-sm">é»æ“Šã€Œå»æ’ç¨‹ã€</p><p className="text-xs text-slate-500">ç•¶éˆæ„Ÿæˆç†Ÿäº†ï¼Œé»æ“Šç®­é ­æŒ‰éˆ•å°‡å…¶è½‰ç‚ºè‰ç¨¿ã€‚</p></div>
                                                    </div>
                                                    <div className="flex items-start gap-3">
                                                        <div className="bg-indigo-100 text-indigo-600 w-6 h-6 rounded-full flex items-center justify-center font-bold text-sm shrink-0 mt-0.5">3</div>
                                                        <div><p className="font-bold text-slate-700 text-sm">è¨­å®šæ™‚é–“èˆ‡å¹³å°</p><p className="text-xs text-slate-500">å¡«å¯«ç™¼å¸ƒæ—¥æœŸã€æ™‚é–“ï¼Œé¸æ“‡è¦ç™¼å¸ƒçš„ç¤¾ç¾¤å¹³å°ï¼ˆIG/FB/Threadsï¼‰ã€‚</p></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <p className="text-sm font-medium text-slate-400">ç¾åœ¨å°±é–‹å§‹ç¬¬ä¸€æ­¥å§ï¼ğŸ‘‡</p>
                                        </div>
                                    </div>
                                ) : (
                                    <div className={`${viewMode === 'grid' ? 'grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-5' : 'flex flex-col gap-3'}`}>
                                        {scheduledPosts.map(post => (
                                            <div key={post.id} className={`bg-white rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition-all group overflow-hidden flex flex-col ${viewMode === 'list' ? 'sm:flex-row' : ''}`}>
                                                {(post.image || viewMode === 'grid') && (
                                                    <div className={`relative bg-slate-100 flex items-center justify-center overflow-hidden shrink-0 ${viewMode === 'list' ? (post.image ? 'w-full sm:w-40 h-40 sm:h-auto' : 'hidden') : 'h-40 w-full'}`}>
                                                        {post.image ? (<img src={post.image} alt="Preview" className="w-full h-full object-cover" />) : (<ImageIcon className="w-8 h-8 text-slate-300" />)}
                                                        {viewMode === 'grid' && (
                                                            <div className={`absolute top-3 left-3 px-2.5 py-1 rounded-full text-[10px] font-bold border shadow-sm backdrop-blur-md ${getStatusColor(post.status)}`}>{getStatusLabel(post.status)}</div>
                                                        )}
                                                    </div>
                                                )}
                                                <div className="p-4 flex-1 flex flex-col min-w-0">
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div className="flex items-center gap-1.5">
                                                            {(post.platforms || [post.platform]).map(p => (
                                                                <div key={p} className="bg-slate-50 p-1 rounded-md border border-slate-100" title={getPlatformLabel(p)}>{getPlatformIcon(p, "w-3.5 h-3.5")}</div>
                                                            ))}
                                                        </div>
                                                        {viewMode === 'list' && (<div className={`px-2.5 py-0.5 rounded-full text-xs font-bold border ${getStatusColor(post.status)}`}>{getStatusLabel(post.status)}</div>)}
                                                    </div>
                                                    <h3 className="font-bold text-slate-800 mb-1 truncate text-base">{post.title || 'æœªå‘½åè²¼æ–‡'}</h3>
                                                    {post.status === 'published' && (
                                                        <div className="flex items-center gap-3 mt-1.5 mb-2 bg-slate-100/70 p-1.5 rounded-lg border border-slate-100 text-xs font-medium text-slate-600 animate-[fadeIn_0.5s_ease-out]">
                                                            <div className="flex items-center gap-1" title="æŒ‰è®šæ•¸"><Heart className="w-3.5 h-3.5 text-pink-500 fill-pink-500/10" /> {post.likes || 0}</div>
                                                            <div className="flex items-center gap-1" title="ç•™è¨€æ•¸"><MessageCircle className="w-3.5 h-3.5 text-blue-500 fill-blue-500/10" /> {post.comments || 0}</div>
                                                            {post.rating === 'good' && (<div className="flex items-center gap-1 text-orange-600 font-bold ml-auto px-1.5 py-0.5 bg-orange-100 rounded"><Flame className="w-3 h-3 fill-orange-500" /> äº®çœ¼</div>)}
                                                            {post.rating === 'normal' && (<div className="flex items-center gap-1 text-slate-500 ml-auto px-1.5 py-0.5 bg-slate-200 rounded"><ThumbsUp className="w-3 h-3" /> æŒå¹³</div>)}
                                                        </div>
                                                    )}
                                                    <div className="flex items-center gap-3 text-xs text-slate-500 mb-3 font-medium">
                                                        <div className={`flex items-center gap-1 ${!post.date && 'text-red-400'}`}><Calendar className="w-3.5 h-3.5" /><span>{post.date || 'æœªè¨­å®šæ—¥æœŸ'}</span></div>
                                                        {post.time && (<div className="flex items-center gap-1"><Clock className="w-3.5 h-3.5" /><span>{post.time}</span></div>)}
                                                    </div>
                                                    <div className="bg-slate-50 p-2.5 rounded-lg border border-slate-100 text-sm text-slate-600 mb-3 relative group/text flex-1">
                                                        <p className="whitespace-pre-wrap line-clamp-2 font-sans">{post.content || post.shortContent || 'ï¼ˆç„¡å…§å®¹ï¼‰'}</p>
                                                    </div>
                                                    <div className="flex justify-between items-center mt-auto pt-2 border-t border-slate-50">
                                                        <button onClick={() => copyContent(post.content || post.shortContent)} className="text-xs font-bold text-slate-500 hover:text-indigo-600 flex items-center gap-1 transition-colors group/copy" title="è¤‡è£½å…§å®¹"><Copy className="w-3.5 h-3.5 group-hover/copy:scale-110 transition-transform" /> <span>è¤‡è£½</span></button>
                                                        <div className="flex gap-1">
                                                            <button onClick={() => handleEdit(post)} className="p-1.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-md transition-colors"><Edit2 className="w-4 h-4" /></button>
                                                            <button onClick={() => handleDelete(post.id)} className="p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-md transition-colors"><Trash2 className="w-4 h-4" /></button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </main>
                        
                        <div className="md:hidden border-t border-slate-200 bg-white flex justify-around items-center p-2 shrink-0 z-10 safe-area-bottom shadow-[0_-1px_10px_rgba(0,0,0,0.05)]">
                            <button onClick={() => setMobileTab('ideas')} className={`flex flex-col items-center gap-1 p-2 rounded-lg transition-colors w-full ${mobileTab === 'ideas' ? 'text-indigo-600 bg-indigo-50/50' : 'text-slate-400'}`}><Lightbulb className="w-6 h-6" /><span className="text-[10px] font-bold">éˆæ„Ÿåº«</span></button>
                            <button onClick={() => setMobileTab('schedule')} className={`flex flex-col items-center gap-1 p-2 rounded-lg transition-colors w-full ${mobileTab === 'schedule' ? 'text-indigo-600 bg-indigo-50/50' : 'text-slate-400'}`}><Calendar className="w-6 h-6" /><span className="text-[10px] font-bold">æ’ç¨‹è¡¨</span></button>
                        </div>
                    </div>

                    {/* Template Library Modal (Updated UI with Tag Filter) */}
                    {isTemplateModalOpen && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex justify-center items-end sm:items-center p-0 sm:p-4">
                            <div className="bg-white rounded-t-2xl sm:rounded-2xl shadow-2xl w-full max-w-4xl h-[85vh] flex flex-col animate-[fadeIn_0.2s_ease-out] sm:h-[85vh] h-[95vh] modal-content-mobile">
                                <div className="p-6 border-b border-slate-100 flex justify-between items-center bg-gradient-to-r from-indigo-50 to-white rounded-t-2xl shrink-0">
                                    <div><h2 className="text-2xl font-bold text-slate-800 flex items-center gap-2"><Book className="w-6 h-6 text-indigo-600" /> æ–‡æ¡ˆæ¨¡æ¿åº«</h2><p className="text-slate-500 text-sm mt-1 hidden sm:block">ä¾ç…§æƒ…å¢ƒèˆ‡ç‹€æ…‹ï¼Œå¿«é€Ÿæ‰¾åˆ°é©åˆçš„éˆæ„Ÿï¼</p></div>
                                    <button onClick={() => setIsTemplateModalOpen(false)} className="text-slate-400 hover:text-slate-600 p-2 hover:bg-slate-100 rounded-full transition-colors"><X className="w-6 h-6" /></button>
                                </div>
                                
                                {/* 1. Category Filter */}
                                <div className="p-2 bg-slate-50/50 border-b border-slate-100 overflow-x-auto scrollbar-hide shrink-0">
                                    <div className="flex gap-2 min-w-max px-4">
                                        <button onClick={() => setSelectedTemplateCategory('all')} className={`px-4 py-2 rounded-full text-sm font-bold transition-all ${selectedTemplateCategory === 'all' ? 'bg-slate-800 text-white shadow-md' : 'bg-white text-slate-600 hover:bg-slate-100'}`}>å…¨éƒ¨é¡¯ç¤º</button>
                                        {Object.entries(CATEGORY_LABELS).map(([key, config]) => (
                                            <button key={key} onClick={() => setSelectedTemplateCategory(key)} className={`px-4 py-2 rounded-full text-sm font-bold flex items-center gap-2 transition-all ${selectedTemplateCategory === key ? `${config.color} ring-2 ring-offset-1 ring-current shadow-md` : 'bg-white text-slate-600 hover:bg-slate-100'}`}><span>{config.icon}</span> {config.label}</button>
                                        ))}
                                    </div>
                                </div>

                                {/* 2. Tag Filter Area (Visible mostly for Threads or All) */}
                                {(selectedTemplateCategory.startsWith('th_') || selectedTemplateCategory === 'all') && (
                                    <div className="px-6 py-3 bg-indigo-50/30 border-b border-indigo-100 overflow-x-auto shrink-0">
                                        <div className="flex gap-4 min-w-max">
                                            {Object.entries(THREADS_TAG_GROUPS).map(([groupName, tags]) => (
                                                <div key={groupName} className="flex items-center gap-2">
                                                    <span className="text-xs font-bold text-indigo-300">{groupName}</span>
                                                    {tags.map(tag => (
                                                        <button 
                                                            key={tag} 
                                                            onClick={() => toggleTag(tag)}
                                                            className={`px-2 py-1 rounded text-xs font-bold transition-all border ${selectedTags.includes(tag) ? 'bg-indigo-500 text-white border-indigo-500 shadow-sm' : 'bg-white text-slate-500 border-slate-200 hover:border-indigo-300 hover:text-indigo-500'}`}
                                                        >
                                                            {tag}
                                                        </button>
                                                    ))}
                                                </div>
                                            ))}
                                            {selectedTags.length > 0 && (
                                                <button onClick={() => setSelectedTags([])} className="px-2 py-1 rounded text-xs font-bold text-red-400 hover:bg-red-50 transition-colors">æ¸…é™¤</button>
                                            )}
                                        </div>
                                    </div>
                                )}

                                <div className="flex-1 overflow-y-auto p-6 bg-slate-50 custom-scrollbar">
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {filteredTemplates.map(template => (
                                            <div key={template.id} className="bg-white rounded-xl border border-slate-200 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all group flex flex-col h-full">
                                                <div className="p-5 flex-1">
                                                    <div className="flex justify-between items-start mb-3">
                                                        <div className="flex flex-col gap-1.5">
                                                            {/* åˆ†é¡æ¨™ç±¤ */}
                                                            <div className="flex gap-2">
                                                                <div className={`text-[10px] font-bold px-2 py-1 rounded border ${CATEGORY_LABELS[template.mainCategory].color.replace('bg-', 'bg-opacity-20 ')}`}>{CATEGORY_LABELS[template.mainCategory].label}</div>
                                                                {template.subCategory && (<div className="text-[10px] font-bold px-2 py-1 rounded border bg-slate-100 text-slate-600">{template.subCategory}</div>)}
                                                            </div>
                                                            {/* å„ªåŒ– 2ï¼šæƒ…ç·’/ç‹€æ…‹æ¨™ç±¤é¡¯ç¤º */}
                                                            {template.mood && (
                                                                <div className="text-[10px] font-bold text-slate-500 flex items-center gap-1">
                                                                    å¿ƒæƒ…ï¼š<span className="bg-yellow-50 text-yellow-700 px-1.5 rounded">{template.mood}</span>
                                                                </div>
                                                            )}
                                                        </div>
                                                        <div className="flex gap-1">{template.platforms.map(p => (<div key={p} className="text-slate-400" title={getPlatformLabel(p)}>{getPlatformIcon(p, "w-3.5 h-3.5")}</div>))}</div>
                                                    </div>
                                                    <h3 className="font-bold text-slate-800 text-lg mb-2 line-clamp-1">{template.title}</h3>
                                                    <div className="bg-slate-50 p-3 rounded-lg border border-slate-100 text-sm text-slate-600 font-medium mb-3 h-32 overflow-hidden relative">
                                                        <p className="whitespace-pre-wrap">{template.content}</p>
                                                        <div className="absolute bottom-0 left-0 w-full h-12 bg-gradient-to-t from-slate-50 to-transparent"></div>
                                                    </div>
                                                    {/* å„ªåŒ– 3ï¼šä½¿ç”¨æé†’ (é¡¯ç¤ºæ¨™ç±¤) */}
                                                    {template.usageTip && (
                                                        <div className="mb-2 text-xs text-indigo-600 font-bold bg-indigo-50 p-1.5 rounded-lg border border-indigo-100 flex items-center gap-1">
                                                            {template.usageTip}
                                                        </div>
                                                    )}
                                                    <div className="flex flex-wrap gap-1.5 mb-2">
                                                        {template.tags.map(tag => (
                                                            <span key={tag} className={`text-[10px] px-1.5 py-0.5 rounded border transition-colors ${selectedTags.includes(tag) ? 'bg-yellow-100 text-yellow-800 border-yellow-200 font-bold' : 'bg-slate-100 text-slate-500 border-slate-200'}`}>
                                                                {tag}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </div>
                                                <div className="p-4 border-t border-slate-100 bg-slate-50/50 rounded-b-xl">
                                                    <button onClick={() => applyLibraryTemplate(template)} className="w-full py-2.5 bg-white border border-slate-300 text-slate-700 font-bold rounded-lg hover:bg-indigo-600 hover:text-white hover:border-indigo-600 transition-colors shadow-sm flex justify-center items-center gap-2"><FileText className="w-4 h-4" /> å¥—ç”¨æ­¤æ¨¡æ¿</button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* API Key Modal & Edit/Add Modal (Same as before) */}
                    {showApiKeyModal && <ApiKeyModal />}
                    {isFormOpen && (
                        <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex justify-center items-end sm:items-center p-0 sm:p-4">
                            <div className="bg-white rounded-t-2xl sm:rounded-2xl shadow-2xl w-full sm:w-[95%] max-w-2xl flex flex-col h-[95vh] sm:max-h-[90vh] animate-[fadeIn_0.2s_ease-out] modal-content-mobile">
                                <div className="p-5 border-b border-slate-100 flex justify-between items-center shrink-0">
                                    <h2 className="text-xl font-bold text-slate-800">{formData.id && formData.status !== 'idea' ? 'ç·¨è¼¯è²¼æ–‡' : 'è²¼æ–‡æ’ç¨‹è¨­å®š'}</h2>
                                    <button onClick={() => setIsFormOpen(false)} className="text-slate-400 hover:text-slate-600 p-1 hover:bg-slate-100 rounded-full transition-colors"><X className="w-6 h-6" /></button>
                                </div>
                                <form onSubmit={handleSubmit} className="p-6 space-y-6 overflow-y-auto custom-scrollbar flex-1">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-bold text-slate-700 mb-2">ç™¼å¸ƒå¹³å° (å¯è¤‡é¸)</label>
                                                <div className="flex gap-2">
                                                    {['instagram', 'facebook', 'threads'].map(p => {
                                                        const isSelected = formData.platforms.includes(p);
                                                        return (
                                                            <button key={p} type="button" onClick={() => togglePlatform(p)} className={`flex-1 py-2.5 px-2 rounded-xl border flex flex-col items-center justify-center gap-1 transition-all ${isSelected ? 'bg-indigo-50 border-indigo-500 text-indigo-700 ring-1 ring-indigo-500' : 'bg-white border-slate-200 text-slate-500 hover:bg-slate-50'}`}>
                                                                {getPlatformIcon(p, "w-5 h-5")}<span className="text-[10px] font-bold uppercase">{getPlatformLabel(p)}</span>{isSelected && <div className="absolute top-[-4px] right-[-4px]"><Check className="w-3 h-3 text-white bg-indigo-500 rounded-full p-0.5" /></div>}
                                                            </button>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-bold text-slate-700 mb-1.5">ç›®å‰ç‹€æ…‹</label>
                                                <select name="status" value={formData.status} onChange={handleInputChange} className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none appearance-none font-medium text-slate-700">
                                                    <option value="draft">ğŸ“ æ’°å¯«è‰ç¨¿</option><option value="scheduled">â° å·²æ’ç¨‹</option><option value="published">âœ… å·²ç™¼å¸ƒ</option>
                                                </select>
                                            </div>
                                            {formData.status === 'published' && (
                                                <div className="bg-indigo-50 p-4 rounded-xl border border-indigo-100 animate-[fadeIn_0.3s_ease-out]">
                                                    <div className="flex items-center gap-2 mb-3 text-indigo-800 font-bold text-sm"><BarChart2 className="w-4 h-4" />æˆæ•ˆå›é¡§</div>
                                                    <div className="grid grid-cols-2 gap-3 mb-3">
                                                        <div><label className="text-xs font-bold text-indigo-600 mb-1 block">æŒ‰è®šæ•¸</label><input type="number" name="likes" value={formData.likes} onChange={handleInputChange} className="w-full p-2 rounded-lg border border-indigo-200 text-sm focus:ring-2 focus:ring-indigo-500 outline-none text-center font-bold text-indigo-900" placeholder="0" /></div>
                                                        <div><label className="text-xs font-bold text-indigo-600 mb-1 block">ç•™è¨€æ•¸</label><input type="number" name="comments" value={formData.comments} onChange={handleInputChange} className="w-full p-2 rounded-lg border border-indigo-200 text-sm focus:ring-2 focus:ring-indigo-500 outline-none text-center font-bold text-indigo-900" placeholder="0" /></div>
                                                    </div>
                                                    <div>
                                                        <label className="text-xs font-bold text-indigo-600 mb-1 block">è‡ªè©•è¡¨ç¾</label>
                                                        <div className="flex bg-white rounded-lg p-1 border border-indigo-100">
                                                            <button type="button" onClick={() => setFormData({...formData, rating: 'normal'})} className={`flex-1 py-1.5 text-xs font-bold rounded flex items-center justify-center gap-1 transition-all ${formData.rating === 'normal' ? 'bg-indigo-100 text-indigo-700 shadow-sm' : 'text-slate-400 hover:text-indigo-600'}`}><ThumbsUp className="w-3 h-3" /> æŒå¹³</button>
                                                            <button type="button" onClick={() => setFormData({...formData, rating: 'good'})} className={`flex-1 py-1.5 text-xs font-bold rounded flex items-center justify-center gap-1 transition-all ${formData.rating === 'good' ? 'bg-orange-100 text-orange-600 shadow-sm' : 'text-slate-400 hover:text-orange-500'}`}><Flame className="w-3 h-3" /> äº®çœ¼</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                            <div><label className="block text-sm font-bold text-slate-700 mb-1.5">è²¼æ–‡ä¸»é¡Œ</label><input type="text" name="title" required placeholder="ä¾‹å¦‚ï¼šæ¯è¦ªç¯€ä¿ƒéŠ·æ´»å‹•" value={formData.title} onChange={handleInputChange} className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none placeholder:text-slate-400" /></div>
                                            <div className="grid grid-cols-2 gap-3">
                                                <div><label className="block text-sm font-bold text-slate-700 mb-1.5">æ—¥æœŸ</label><input type="date" name="date" value={formData.date} onChange={handleInputChange} className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none" /></div>
                                                <div><label className="block text-sm font-bold text-slate-700 mb-1.5">æ™‚é–“</label><input type="time" name="time" value={formData.time} onChange={handleInputChange} className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none" /></div>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-bold text-slate-700 mb-2">åœ–ç‰‡ç´ æ</label>
                                                {!formData.image ? (
                                                    <div onClick={() => fileInputRef.current.click()} className="border-2 border-dashed border-slate-300 rounded-xl p-6 flex flex-col items-center justify-center text-slate-400 hover:border-indigo-500 hover:text-indigo-500 hover:bg-indigo-50 transition-all cursor-pointer h-32 group">
                                                        <Upload className="w-8 h-8 mb-2 group-hover:scale-110 transition-transform" /><span className="text-sm font-medium">é»æ“Šä¸Šå‚³åœ–ç‰‡</span>
                                                    </div>
                                                ) : (
                                                    <div className="relative rounded-xl overflow-hidden border border-slate-200 group h-48 bg-slate-100 flex items-center justify-center">
                                                        <img src={formData.image} alt="Preview" className="h-full object-contain" />
                                                        <button type="button" onClick={removeImage} className="absolute top-2 right-2 bg-white/90 p-1.5 rounded-full shadow-sm text-slate-500 hover:text-red-500 transition-colors"><XCircle className="w-5 h-5" /></button>
                                                    </div>
                                                )}
                                                <input type="file" ref={fileInputRef} onChange={handleImageUpload} accept="image/*" className="hidden" />
                                            </div>
                                        </div>
                                        <div className="flex flex-col h-full overflow-hidden">
                                            <div className="mb-4">
                                                <div className="flex justify-between items-center mb-2"><label className="block text-sm font-bold text-slate-700 flex items-center gap-2"><Sparkles className="w-4 h-4 text-indigo-500" /> AI æ™ºèƒ½å„ªåŒ–</label></div>
                                                <div className="grid grid-cols-2 md:grid-cols-4 gap-2 mb-2">
                                                    {AI_TONES.map(tone => (<button key={tone.id} type="button" onClick={() => optimizeContent(tone)} disabled={isOptimizing} className="text-xs bg-indigo-50 text-indigo-700 px-2 py-2 rounded-lg border border-indigo-100 hover:bg-indigo-100 transition-all disabled:opacity-50 whitespace-nowrap flex justify-center items-center" title={tone.desc}>{tone.label}</button>))}
                                                </div>
                                                {aiTone && (<div className="text-[10px] text-slate-500 bg-slate-50 p-2 rounded-lg border border-slate-100 mt-1 animate-[fadeIn_0.3s_ease-out]">ğŸ’¡ å¹³å°å»ºè­°ï¼š{aiTone.platforms} - {aiTone.desc}</div>)}
                                            </div>
                                            <div className="flex-1 flex flex-col gap-4 overflow-y-auto pr-1 custom-scrollbar" style={{minHeight: 0}}>
                                                <div className="flex-1 flex flex-col min-h-[200px]">
                                                    <div className="flex justify-between items-center mb-1.5"><label className="text-xs font-bold text-slate-600 flex items-center gap-1"><Instagram className="w-3.5 h-3.5" /> IG é•·æ–‡æ¡ˆ (è²¼æ–‡/Reels)</label><span className="text-[10px] text-slate-400 bg-slate-100 px-1.5 rounded">{formData.content.length} å­—</span></div>
                                                    <textarea name="content" placeholder="åœ¨é€™è£¡æ’°å¯« IG å®Œæ•´è²¼æ–‡å…§å®¹..." value={formData.content} onChange={handleInputChange} className="w-full h-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none resize-none font-sans text-sm leading-relaxed"></textarea>
                                                </div>
                                                <div className="flex-shrink-0 h-[120px] flex flex-col">
                                                    <div className="flex justify-between items-center mb-1.5"><label className="text-xs font-bold text-slate-600 flex items-center gap-1"><AtSign className="w-3.5 h-3.5" /> Threads çŸ­æ–‡æ¡ˆ (é™å‹•/ç¢ç¢å¿µ)</label><span className="text-[10px] text-slate-400 bg-slate-100 px-1.5 rounded">{formData.shortContent?.length || 0} å­—</span></div>
                                                    <textarea name="shortContent" placeholder="åœ¨é€™è£¡æ’°å¯« Threads çŸ­å¥æˆ–é™å‹•æ–‡æ¡ˆ..." value={formData.shortContent} onChange={handleInputChange} className="w-full h-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none resize-none font-sans text-sm leading-relaxed"></textarea>
                                                </div>
                                            </div>
                                            <div className="mt-3 pt-3 border-t border-slate-100">
                                                <div className="flex flex-wrap gap-2">
                                                    {Object.entries(HASHTAG_PRESETS).map(([category, tags]) => (
                                                        <div key={category} className="flex flex-wrap gap-1 items-center"><span className="text-[10px] text-slate-400 min-w-[32px]">{category}</span>{tags.slice(0, 3).map(tag => (<button key={tag} type="button" onClick={() => addHashtag(tag)} className="px-1.5 py-0.5 bg-slate-100 text-slate-600 text-[10px] rounded hover:bg-indigo-100 hover:text-indigo-700 transition-colors">{tag}</button>))}</div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="pt-4 flex gap-3 border-t border-slate-100 mt-4 shrink-0">
                                        <button type="button" onClick={() => setIsFormOpen(false)} className="flex-1 py-3 px-4 bg-white border border-slate-200 text-slate-600 rounded-xl hover:bg-slate-50 font-bold transition-colors">å–æ¶ˆ</button>
                                        <button type="submit" className="flex-1 py-3 px-4 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 shadow-lg shadow-indigo-200 font-bold flex justify-center items-center gap-2 transition-transform active:scale-95"><Save className="w-5 h-5" /> {formData.status === 'idea' ? 'è½‰ç‚ºè‰ç¨¿' : 'å„²å­˜è¨­å®š'}</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SocialMediaPlanner />);
    </script>
</body>
</html>
